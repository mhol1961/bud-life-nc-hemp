import{r as j,a as fr,R as We,b as gr,c as G,u as pr,d as js,L as Bt,B as xr,e as Mt,f as W,N as qt}from"./vendor-BHGMFwK6.js";import{t as yr,c as _s,S as ae,X as Ot,M as br,P as Je,T as vr,C as He,U as Ns,a as Ce,b as ks,d as $t,L as Ft,e as yt,f as Ss,A as wr,g as jr,h as X,F as Cs,i as Pe,j as Es,I as Ts,k as As,l as Ps,B as Os,m as $s,n as _r,o as Nr,p as Qe,q as kr,r as Sr,s as Cr,u as Er,v as Rs,w as Is,D as Ls,x as Ds,y as Tr,Z as Us,z as Ar,E as Pr,G as Or,H as $r,J as Rr,K as Ke,N as Ir,O as bt,Q as zt,R as Vt,V as ee,W as it,Y as Wt,_ as Ue,$ as Lr,a0 as Ht,a1 as Dr,a2 as ot,a3 as Be,a4 as Kt,a5 as Jt,a6 as vt}from"./ui-BZmQQcgd.js";import{R as lt,A as Ur,C as Gt,X as Yt,Y as Qt,T as ct,a as Br,P as Mr,b as qr,c as Xt,B as Zt,d as Fr}from"./charts-CLJ4yhF2.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function s(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(a){if(a.ep)return;a.ep=!0;const i=s(a);fetch(a.href,i)}})();var Bs={exports:{}},Xe={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zr=j,Vr=Symbol.for("react.element"),Wr=Symbol.for("react.fragment"),Hr=Object.prototype.hasOwnProperty,Kr=zr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Jr={key:!0,ref:!0,__self:!0,__source:!0};function Ms(n,e,s){var r,a={},i=null,o=null;s!==void 0&&(i=""+s),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)Hr.call(e,r)&&!Jr.hasOwnProperty(r)&&(a[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)a[r]===void 0&&(a[r]=e[r]);return{$$typeof:Vr,type:n,key:i,ref:o,props:a,_owner:Kr.current}}Xe.Fragment=Wr;Xe.jsx=Ms;Xe.jsxs=Ms;Bs.exports=Xe;var t=Bs.exports,qs,es=fr;qs=es.createRoot,es.hydrateRoot;const Gr=n=>n instanceof Error?n.message+`
`+n.stack:JSON.stringify(n,null,2);class Yr extends We.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}render(){return this.state.hasError?t.jsxs("div",{className:"p-4 border border-red-500 rounded",children:[t.jsx("h2",{className:"text-red-500",children:"Something went wrong."}),t.jsx("pre",{className:"mt-2 text-sm",children:Gr(this.state.error)})]}):this.props.children}}function J(...n){return yr(_s(n))}function M(n){const e=typeof n=="string"?parseFloat(n):n;return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e)}const ts=n=>typeof n=="boolean"?`${n}`:n===0?"0":n,ss=_s,Fs=(n,e)=>s=>{var r;if((e==null?void 0:e.variants)==null)return ss(n,s==null?void 0:s.class,s==null?void 0:s.className);const{variants:a,defaultVariants:i}=e,o=Object.keys(a).map(d=>{const h=s==null?void 0:s[d],u=i==null?void 0:i[d];if(h===null)return null;const f=ts(h)||ts(u);return a[d][f]}),l=s&&Object.entries(s).reduce((d,h)=>{let[u,f]=h;return f===void 0||(d[u]=f),d},{}),c=e==null||(r=e.compoundVariants)===null||r===void 0?void 0:r.reduce((d,h)=>{let{class:u,className:f,...g}=h;return Object.entries(g).every(x=>{let[w,v]=x;return Array.isArray(v)?v.includes({...i,...l}[w]):{...i,...l}[w]===v})?[...d,u,f]:d},[]);return ss(n,o,c,s==null?void 0:s.class,s==null?void 0:s.className)},Qr=Fs("inline-flex items-center justify-center whitespace-nowrap rounded-lg text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 shadow-sm hover:shadow-md transform hover:-translate-y-0.5 active:scale-95",{variants:{variant:{default:"bg-gradient-to-r from-blue-600 to-blue-700 text-white hover:from-blue-700 hover:to-blue-800",destructive:"bg-gradient-to-r from-red-600 to-red-700 text-white hover:from-red-700 hover:to-red-800",outline:"border-2 border-gray-200 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-300",secondary:"bg-gradient-to-r from-gray-600 to-gray-700 text-white hover:from-gray-700 hover:to-gray-800",ghost:"text-gray-700 hover:bg-gray-100 hover:text-gray-900",success:"bg-gradient-to-r from-emerald-600 to-emerald-700 text-white hover:from-emerald-700 hover:to-emerald-800",warning:"bg-gradient-to-r from-orange-600 to-orange-700 text-white hover:from-orange-700 hover:to-orange-800",info:"bg-gradient-to-r from-blue-500 to-blue-600 text-white hover:from-blue-600 hover:to-blue-700"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",xl:"h-12 rounded-lg px-10 text-base",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),S=j.forwardRef(({className:n,variant:e,size:s,asChild:r=!1,...a},i)=>t.jsx("button",{className:J(Qr({variant:e,size:s,className:n})),ref:i,...a}));S.displayName="Button";const Xr=Fs("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 shadow-sm",{variants:{variant:{default:"border-transparent bg-gradient-to-r from-blue-600 to-purple-600 text-white hover:from-blue-700 hover:to-purple-700",secondary:"border-transparent bg-gradient-to-r from-gray-600 to-gray-700 text-white",destructive:"border-transparent bg-gradient-to-r from-red-600 to-pink-600 text-white",success:"border-transparent bg-gradient-to-r from-emerald-600 to-green-600 text-white",warning:"border-transparent bg-gradient-to-r from-amber-500 to-orange-500 text-white",info:"border-transparent bg-gradient-to-r from-cyan-500 to-blue-500 text-white",outline:"border-gray-300 text-gray-700 bg-white",ghost:"border-transparent bg-gray-100 text-gray-700 hover:bg-gray-200"},size:{default:"px-2.5 py-0.5 text-xs",sm:"px-2 py-0.5 text-xs",lg:"px-3 py-1 text-sm"}},defaultVariants:{variant:"default",size:"default"}});function D({className:n,variant:e,size:s,...r}){return t.jsx("div",{className:J(Xr({variant:e,size:s}),n),...r})}const T=j.forwardRef(({className:n,...e},s)=>t.jsx("div",{ref:s,className:J("rounded-xl border bg-white/80 backdrop-blur-sm shadow-lg hover:shadow-xl transition-all duration-300 border-gray-100/50",n),...e}));T.displayName="Card";const L=j.forwardRef(({className:n,...e},s)=>t.jsx("div",{ref:s,className:J("flex flex-col space-y-1.5 p-6",n),...e}));L.displayName="CardHeader";const U=j.forwardRef(({className:n,...e},s)=>t.jsx("h3",{ref:s,className:J("text-2xl font-semibold leading-none tracking-tight bg-gradient-to-r from-gray-900 to-gray-600 bg-clip-text text-transparent",n),...e}));U.displayName="CardTitle";const Zr=j.forwardRef(({className:n,...e},s)=>t.jsx("p",{ref:s,className:J("text-sm text-gray-600",n),...e}));Zr.displayName="CardDescription";const E=j.forwardRef(({className:n,...e},s)=>t.jsx("div",{ref:s,className:J("p-6 pt-0",n),...e}));E.displayName="CardContent";const ea=j.forwardRef(({className:n,...e},s)=>t.jsx("div",{ref:s,className:J("flex items-center p-6 pt-0",n),...e}));ea.displayName="CardFooter";const ta="modulepreload",sa=function(n){return"/"+n},rs={},$e=function(e,s,r){let a=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));a=Promise.allSettled(s.map(c=>{if(c=sa(c),c in rs)return;rs[c]=!0;const d=c.endsWith(".css"),h=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${h}`))return;const u=document.createElement("link");if(u.rel=d?"stylesheet":ta,d||(u.as="script"),u.crossOrigin="",u.href=c,l&&u.setAttribute("nonce",l),document.head.appendChild(u),d)return new Promise((f,g)=>{u.addEventListener("load",f),u.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return a.then(o=>{for(const l of o||[])l.status==="rejected"&&i(l.reason);return e().catch(i)})},ra=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...s)=>$e(async()=>{const{default:r}=await Promise.resolve().then(()=>_e);return{default:r}},void 0).then(({default:r})=>r(...s)):e=fetch,(...s)=>e(...s)};class Rt extends Error{constructor(e,s="FunctionsError",r){super(e),this.name=s,this.context=r}}class aa extends Rt{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class as extends Rt{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class ns extends Rt{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var wt;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(wt||(wt={}));var na=function(n,e,s,r){function a(i){return i instanceof s?i:new s(function(o){o(i)})}return new(s||(s=Promise))(function(i,o){function l(h){try{d(r.next(h))}catch(u){o(u)}}function c(h){try{d(r.throw(h))}catch(u){o(u)}}function d(h){h.done?i(h.value):a(h.value).then(l,c)}d((r=r.apply(n,e||[])).next())})};class ia{constructor(e,{headers:s={},customFetch:r,region:a=wt.Any}={}){this.url=e,this.headers=s,this.region=a,this.fetch=ra(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,s={}){var r;return na(this,void 0,void 0,function*(){try{const{headers:a,method:i,body:o}=s;let l={},{region:c}=s;c||(c=this.region);const d=new URL(`${this.url}/${e}`);c&&c!=="any"&&(l["x-region"]=c,d.searchParams.set("forceFunctionRegion",c));let h;o&&(a&&!Object.prototype.hasOwnProperty.call(a,"Content-Type")||!a)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(l["Content-Type"]="application/octet-stream",h=o):typeof o=="string"?(l["Content-Type"]="text/plain",h=o):typeof FormData<"u"&&o instanceof FormData?h=o:(l["Content-Type"]="application/json",h=JSON.stringify(o)));const u=yield this.fetch(d.toString(),{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},l),this.headers),a),body:h}).catch(w=>{throw new aa(w)}),f=u.headers.get("x-relay-error");if(f&&f==="true")throw new as(u);if(!u.ok)throw new ns(u);let g=((r=u.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),x;return g==="application/json"?x=yield u.json():g==="application/octet-stream"?x=yield u.blob():g==="text/event-stream"?x=u:g==="multipart/form-data"?x=yield u.formData():x=yield u.text(),{data:x,error:null,response:u}}catch(a){return{data:null,error:a,response:a instanceof ns||a instanceof as?a.context:void 0}}})}}var K={},It={},Ze={},Re={},et={},tt={},oa=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},je=oa();const la=je.fetch,zs=je.fetch.bind(je),Vs=je.Headers,ca=je.Request,da=je.Response,_e=Object.freeze(Object.defineProperty({__proto__:null,Headers:Vs,Request:ca,Response:da,default:zs,fetch:la},Symbol.toStringTag,{value:"Module"})),ha=gr(_e);var st={};Object.defineProperty(st,"__esModule",{value:!0});let ua=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};st.default=ua;var Ws=G&&G.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(tt,"__esModule",{value:!0});const ma=Ws(ha),fa=Ws(st);let ga=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=ma.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,s){return this.headers=Object.assign({},this.headers),this.headers[e]=s,this}then(e,s){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const r=this.fetch;let a=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{var o,l,c;let d=null,h=null,u=null,f=i.status,g=i.statusText;if(i.ok){if(this.method!=="HEAD"){const N=await i.text();N===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?h=N:h=JSON.parse(N))}const w=(o=this.headers.Prefer)===null||o===void 0?void 0:o.match(/count=(exact|planned|estimated)/),v=(l=i.headers.get("content-range"))===null||l===void 0?void 0:l.split("/");w&&v&&v.length>1&&(u=parseInt(v[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(h)&&(h.length>1?(d={code:"PGRST116",details:`Results contain ${h.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},h=null,u=null,f=406,g="Not Acceptable"):h.length===1?h=h[0]:h=null)}else{const w=await i.text();try{d=JSON.parse(w),Array.isArray(d)&&i.status===404&&(h=[],d=null,f=200,g="OK")}catch{i.status===404&&w===""?(f=204,g="No Content"):d={message:w}}if(d&&this.isMaybeSingle&&(!((c=d==null?void 0:d.details)===null||c===void 0)&&c.includes("0 rows"))&&(d=null,f=200,g="OK"),d&&this.shouldThrowOnError)throw new fa.default(d)}return{error:d,data:h,count:u,status:f,statusText:g}});return this.shouldThrowOnError||(a=a.catch(i=>{var o,l,c;return{error:{message:`${(o=i==null?void 0:i.name)!==null&&o!==void 0?o:"FetchError"}: ${i==null?void 0:i.message}`,details:`${(l=i==null?void 0:i.stack)!==null&&l!==void 0?l:""}`,hint:"",code:`${(c=i==null?void 0:i.code)!==null&&c!==void 0?c:""}`},data:null,count:null,status:0,statusText:""}})),a.then(e,s)}returns(){return this}overrideTypes(){return this}};tt.default=ga;var pa=G&&G.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(et,"__esModule",{value:!0});const xa=pa(tt);let ya=class extends xa.default{select(e){let s=!1;const r=(e??"*").split("").map(a=>/\s/.test(a)&&!s?"":(a==='"'&&(s=!s),a)).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:s=!0,nullsFirst:r,foreignTable:a,referencedTable:i=a}={}){const o=i?`${i}.order`:"order",l=this.url.searchParams.get(o);return this.url.searchParams.set(o,`${l?`${l},`:""}${e}.${s?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:s,referencedTable:r=s}={}){const a=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(a,`${e}`),this}range(e,s,{foreignTable:r,referencedTable:a=r}={}){const i=typeof a>"u"?"offset":`${a}.offset`,o=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(i,`${e}`),this.url.searchParams.set(o,`${s-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:s=!1,settings:r=!1,buffers:a=!1,wal:i=!1,format:o="text"}={}){var l;const c=[e?"analyze":null,s?"verbose":null,r?"settings":null,a?"buffers":null,i?"wal":null].filter(Boolean).join("|"),d=(l=this.headers.Accept)!==null&&l!==void 0?l:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${o}; for="${d}"; options=${c};`,o==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};et.default=ya;var ba=G&&G.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Re,"__esModule",{value:!0});const va=ba(et);let wa=class extends va.default{eq(e,s){return this.url.searchParams.append(e,`eq.${s}`),this}neq(e,s){return this.url.searchParams.append(e,`neq.${s}`),this}gt(e,s){return this.url.searchParams.append(e,`gt.${s}`),this}gte(e,s){return this.url.searchParams.append(e,`gte.${s}`),this}lt(e,s){return this.url.searchParams.append(e,`lt.${s}`),this}lte(e,s){return this.url.searchParams.append(e,`lte.${s}`),this}like(e,s){return this.url.searchParams.append(e,`like.${s}`),this}likeAllOf(e,s){return this.url.searchParams.append(e,`like(all).{${s.join(",")}}`),this}likeAnyOf(e,s){return this.url.searchParams.append(e,`like(any).{${s.join(",")}}`),this}ilike(e,s){return this.url.searchParams.append(e,`ilike.${s}`),this}ilikeAllOf(e,s){return this.url.searchParams.append(e,`ilike(all).{${s.join(",")}}`),this}ilikeAnyOf(e,s){return this.url.searchParams.append(e,`ilike(any).{${s.join(",")}}`),this}is(e,s){return this.url.searchParams.append(e,`is.${s}`),this}in(e,s){const r=Array.from(new Set(s)).map(a=>typeof a=="string"&&new RegExp("[,()]").test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,s){return typeof s=="string"?this.url.searchParams.append(e,`cs.${s}`):Array.isArray(s)?this.url.searchParams.append(e,`cs.{${s.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(s)}`),this}containedBy(e,s){return typeof s=="string"?this.url.searchParams.append(e,`cd.${s}`):Array.isArray(s)?this.url.searchParams.append(e,`cd.{${s.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(s)}`),this}rangeGt(e,s){return this.url.searchParams.append(e,`sr.${s}`),this}rangeGte(e,s){return this.url.searchParams.append(e,`nxl.${s}`),this}rangeLt(e,s){return this.url.searchParams.append(e,`sl.${s}`),this}rangeLte(e,s){return this.url.searchParams.append(e,`nxr.${s}`),this}rangeAdjacent(e,s){return this.url.searchParams.append(e,`adj.${s}`),this}overlaps(e,s){return typeof s=="string"?this.url.searchParams.append(e,`ov.${s}`):this.url.searchParams.append(e,`ov.{${s.join(",")}}`),this}textSearch(e,s,{config:r,type:a}={}){let i="";a==="plain"?i="pl":a==="phrase"?i="ph":a==="websearch"&&(i="w");const o=r===void 0?"":`(${r})`;return this.url.searchParams.append(e,`${i}fts${o}.${s}`),this}match(e){return Object.entries(e).forEach(([s,r])=>{this.url.searchParams.append(s,`eq.${r}`)}),this}not(e,s,r){return this.url.searchParams.append(e,`not.${s}.${r}`),this}or(e,{foreignTable:s,referencedTable:r=s}={}){const a=r?`${r}.or`:"or";return this.url.searchParams.append(a,`(${e})`),this}filter(e,s,r){return this.url.searchParams.append(e,`${s}.${r}`),this}};Re.default=wa;var ja=G&&G.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Ze,"__esModule",{value:!0});const ke=ja(Re);let _a=class{constructor(e,{headers:s={},schema:r,fetch:a}){this.url=e,this.headers=s,this.schema=r,this.fetch=a}select(e,{head:s=!1,count:r}={}){const a=s?"HEAD":"GET";let i=!1;const o=(e??"*").split("").map(l=>/\s/.test(l)&&!i?"":(l==='"'&&(i=!i),l)).join("");return this.url.searchParams.set("select",o),r&&(this.headers.Prefer=`count=${r}`),new ke.default({method:a,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:s,defaultToNull:r=!0}={}){const a="POST",i=[];if(this.headers.Prefer&&i.push(this.headers.Prefer),s&&i.push(`count=${s}`),r||i.push("missing=default"),this.headers.Prefer=i.join(","),Array.isArray(e)){const o=e.reduce((l,c)=>l.concat(Object.keys(c)),[]);if(o.length>0){const l=[...new Set(o)].map(c=>`"${c}"`);this.url.searchParams.set("columns",l.join(","))}}return new ke.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:s,ignoreDuplicates:r=!1,count:a,defaultToNull:i=!0}={}){const o="POST",l=[`resolution=${r?"ignore":"merge"}-duplicates`];if(s!==void 0&&this.url.searchParams.set("on_conflict",s),this.headers.Prefer&&l.push(this.headers.Prefer),a&&l.push(`count=${a}`),i||l.push("missing=default"),this.headers.Prefer=l.join(","),Array.isArray(e)){const c=e.reduce((d,h)=>d.concat(Object.keys(h)),[]);if(c.length>0){const d=[...new Set(c)].map(h=>`"${h}"`);this.url.searchParams.set("columns",d.join(","))}}return new ke.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:s}={}){const r="PATCH",a=[];return this.headers.Prefer&&a.push(this.headers.Prefer),s&&a.push(`count=${s}`),this.headers.Prefer=a.join(","),new ke.default({method:r,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const s="DELETE",r=[];return e&&r.push(`count=${e}`),this.headers.Prefer&&r.unshift(this.headers.Prefer),this.headers.Prefer=r.join(","),new ke.default({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};Ze.default=_a;var rt={},at={};Object.defineProperty(at,"__esModule",{value:!0});at.version=void 0;at.version="0.0.0-automated";Object.defineProperty(rt,"__esModule",{value:!0});rt.DEFAULT_HEADERS=void 0;const Na=at;rt.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${Na.version}`};var Hs=G&&G.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(It,"__esModule",{value:!0});const ka=Hs(Ze),Sa=Hs(Re),Ca=rt;let Ea=class Ks{constructor(e,{headers:s={},schema:r,fetch:a}={}){this.url=e,this.headers=Object.assign(Object.assign({},Ca.DEFAULT_HEADERS),s),this.schemaName=r,this.fetch=a}from(e){const s=new URL(`${this.url}/${e}`);return new ka.default(s,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new Ks(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,s={},{head:r=!1,get:a=!1,count:i}={}){let o;const l=new URL(`${this.url}/rpc/${e}`);let c;r||a?(o=r?"HEAD":"GET",Object.entries(s).filter(([h,u])=>u!==void 0).map(([h,u])=>[h,Array.isArray(u)?`{${u.join(",")}}`:`${u}`]).forEach(([h,u])=>{l.searchParams.append(h,u)})):(o="POST",c=s);const d=Object.assign({},this.headers);return i&&(d.Prefer=`count=${i}`),new Sa.default({method:o,url:l,headers:d,schema:this.schemaName,body:c,fetch:this.fetch,allowEmpty:!1})}};It.default=Ea;var Ne=G&&G.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(K,"__esModule",{value:!0});K.PostgrestError=K.PostgrestBuilder=K.PostgrestTransformBuilder=K.PostgrestFilterBuilder=K.PostgrestQueryBuilder=K.PostgrestClient=void 0;const Js=Ne(It);K.PostgrestClient=Js.default;const Gs=Ne(Ze);K.PostgrestQueryBuilder=Gs.default;const Ys=Ne(Re);K.PostgrestFilterBuilder=Ys.default;const Qs=Ne(et);K.PostgrestTransformBuilder=Qs.default;const Xs=Ne(tt);K.PostgrestBuilder=Xs.default;const Zs=Ne(st);K.PostgrestError=Zs.default;var Ta=K.default={PostgrestClient:Js.default,PostgrestQueryBuilder:Gs.default,PostgrestFilterBuilder:Ys.default,PostgrestTransformBuilder:Qs.default,PostgrestBuilder:Xs.default,PostgrestError:Zs.default};const{PostgrestClient:Aa,PostgrestQueryBuilder:ro,PostgrestFilterBuilder:ao,PostgrestTransformBuilder:no,PostgrestBuilder:io,PostgrestError:oo}=Ta;class Pa{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"&&process.versions&&process.versions.node){const s=parseInt(process.versions.node.split(".")[0]);return s>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${s} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${s} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let s=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(s+=`

Suggested solution: ${e.workaround}`),new Error(s)}static createWebSocket(e,s){const r=this.getWebSocketConstructor();return new r(e,s)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const Oa="2.15.1",$a=`realtime-js/${Oa}`,Ra="1.0.0",jt=1e4,Ia=1e3,La=100;var Ee;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(Ee||(Ee={}));var q;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(q||(q={}));var Q;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(Q||(Q={}));var _t;(function(n){n.websocket="websocket"})(_t||(_t={}));var ue;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(ue||(ue={}));class Da{constructor(){this.HEADER_LENGTH=1}decode(e,s){return e.constructor===ArrayBuffer?s(this._binaryDecode(e)):s(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const s=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,s,r)}_decodeBroadcast(e,s,r){const a=s.getUint8(1),i=s.getUint8(2);let o=this.HEADER_LENGTH+2;const l=r.decode(e.slice(o,o+a));o=o+a;const c=r.decode(e.slice(o,o+i));o=o+i;const d=JSON.parse(r.decode(e.slice(o,e.byteLength)));return{ref:null,topic:l,event:c,payload:d}}}class er{constructor(e,s){this.callback=e,this.timerCalc=s,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=s}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var I;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(I||(I={}));const is=(n,e,s={})=>{var r;const a=(r=s.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((i,o)=>(i[o]=Ua(o,n,e,a),i),{})},Ua=(n,e,s,r)=>{const a=e.find(l=>l.name===n),i=a==null?void 0:a.type,o=s[n];return i&&!r.includes(i)?tr(i,o):Nt(o)},tr=(n,e)=>{if(n.charAt(0)==="_"){const s=n.slice(1,n.length);return Fa(e,s)}switch(n){case I.bool:return Ba(e);case I.float4:case I.float8:case I.int2:case I.int4:case I.int8:case I.numeric:case I.oid:return Ma(e);case I.json:case I.jsonb:return qa(e);case I.timestamp:return za(e);case I.abstime:case I.date:case I.daterange:case I.int4range:case I.int8range:case I.money:case I.reltime:case I.text:case I.time:case I.timestamptz:case I.timetz:case I.tsrange:case I.tstzrange:return Nt(e);default:return Nt(e)}},Nt=n=>n,Ba=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},Ma=n=>{if(typeof n=="string"){const e=parseFloat(n);if(!Number.isNaN(e))return e}return n},qa=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(e){return console.log(`JSON parse error: ${e}`),n}return n},Fa=(n,e)=>{if(typeof n!="string")return n;const s=n.length-1,r=n[s];if(n[0]==="{"&&r==="}"){let i;const o=n.slice(1,s);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(l=>tr(e,l))}return n},za=n=>typeof n=="string"?n.replace(" ","T"):n,sr=n=>{let e=n;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"};class dt{constructor(e,s,r={},a=jt){this.channel=e,this.event=s,this.payload=r,this.timeout=a,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,s){var r;return this._hasReceived(e)&&s((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:s}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=s=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=s,this._matchReceive(s)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,s){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:s})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:s}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(s))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var os;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(os||(os={}));class Te{constructor(e,s){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(s==null?void 0:s.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},a=>{const{onJoin:i,onLeave:o,onSync:l}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Te.syncState(this.state,a,i,o),this.pendingDiffs.forEach(c=>{this.state=Te.syncDiff(this.state,c,i,o)}),this.pendingDiffs=[],l()}),this.channel._on(r.diff,{},a=>{const{onJoin:i,onLeave:o,onSync:l}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(a):(this.state=Te.syncDiff(this.state,a,i,o),l())}),this.onJoin((a,i,o)=>{this.channel._trigger("presence",{event:"join",key:a,currentPresences:i,newPresences:o})}),this.onLeave((a,i,o)=>{this.channel._trigger("presence",{event:"leave",key:a,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,s,r,a){const i=this.cloneDeep(e),o=this.transformState(s),l={},c={};return this.map(i,(d,h)=>{o[d]||(c[d]=h)}),this.map(o,(d,h)=>{const u=i[d];if(u){const f=h.map(v=>v.presence_ref),g=u.map(v=>v.presence_ref),x=h.filter(v=>g.indexOf(v.presence_ref)<0),w=u.filter(v=>f.indexOf(v.presence_ref)<0);x.length>0&&(l[d]=x),w.length>0&&(c[d]=w)}else l[d]=h}),this.syncDiff(i,{joins:l,leaves:c},r,a)}static syncDiff(e,s,r,a){const{joins:i,leaves:o}={joins:this.transformState(s.joins),leaves:this.transformState(s.leaves)};return r||(r=()=>{}),a||(a=()=>{}),this.map(i,(l,c)=>{var d;const h=(d=e[l])!==null&&d!==void 0?d:[];if(e[l]=this.cloneDeep(c),h.length>0){const u=e[l].map(g=>g.presence_ref),f=h.filter(g=>u.indexOf(g.presence_ref)<0);e[l].unshift(...f)}r(l,h,c)}),this.map(o,(l,c)=>{let d=e[l];if(!d)return;const h=c.map(u=>u.presence_ref);d=d.filter(u=>h.indexOf(u.presence_ref)<0),e[l]=d,a(l,d,c),d.length===0&&delete e[l]}),e}static map(e,s){return Object.getOwnPropertyNames(e).map(r=>s(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((s,r)=>{const a=e[r];return"metas"in a?s[r]=a.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):s[r]=a,s},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var ls;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(ls||(ls={}));var Ae;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(Ae||(Ae={}));var se;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(se||(se={}));class Lt{constructor(e,s={config:{}},r){this.topic=e,this.params=s,this.socket=r,this.bindings={},this.state=q.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},s.config),this.timeout=this.socket.timeout,this.joinPush=new dt(this,Q.join,this.params,this.timeout),this.rejoinTimer=new er(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=q.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(a=>a.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=q.closed,this.socket._remove(this)}),this._onError(a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=q.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=q.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=q.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Q.reply,{},(a,i)=>{this._trigger(this._replyEventName(i),a)}),this.presence=new Te(this),this.broadcastEndpointURL=sr(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(e,s=this.timeout){var r,a;if(this.socket.isConnected()||this.socket.connect(),this.state==q.closed){const{config:{broadcast:i,presence:o,private:l}}=this.params,c=(a=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(f=>f.filter))!==null&&a!==void 0?a:[],d=!!this.bindings[Ae.PRESENCE]&&this.bindings[Ae.PRESENCE].length>0,h={},u={broadcast:i,presence:Object.assign(Object.assign({},o),{enabled:d}),postgres_changes:c,private:l};this.socket.accessTokenValue&&(h.access_token=this.socket.accessTokenValue),this._onError(f=>e==null?void 0:e(se.CHANNEL_ERROR,f)),this._onClose(()=>e==null?void 0:e(se.CLOSED)),this.updateJoinPayload(Object.assign({config:u},h)),this.joinedOnce=!0,this._rejoin(s),this.joinPush.receive("ok",async({postgres_changes:f})=>{var g;if(this.socket.setAuth(),f===void 0){e==null||e(se.SUBSCRIBED);return}else{const x=this.bindings.postgres_changes,w=(g=x==null?void 0:x.length)!==null&&g!==void 0?g:0,v=[];for(let N=0;N<w;N++){const O=x[N],{filter:{event:b,schema:y,table:C,filter:m}}=O,_=f&&f[N];if(_&&_.event===b&&_.schema===y&&_.table===C&&_.filter===m)v.push(Object.assign(Object.assign({},O),{id:_.id}));else{this.unsubscribe(),this.state=q.errored,e==null||e(se.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=v,e&&e(se.SUBSCRIBED);return}}).receive("error",f=>{this.state=q.errored,e==null||e(se.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(f).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(se.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,s={}){return await this.send({type:"presence",event:"track",payload:e},s.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,s,r){return this.state===q.joined&&e===Ae.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,s,r)}async send(e,s={}){var r,a;if(!this._canPush()&&e.type==="broadcast"){const{event:i,payload:o}=e,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const d=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(r=s.timeout)!==null&&r!==void 0?r:this.timeout);return await((a=d.body)===null||a===void 0?void 0:a.cancel()),d.ok?"ok":"error"}catch(d){return d.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,l,c;const d=this._push(e.type,e,s.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(l=(o=this.params)===null||o===void 0?void 0:o.config)===null||l===void 0?void 0:l.broadcast)===null||c===void 0)&&c.ack)&&i("ok"),d.receive("ok",()=>i("ok")),d.receive("error",()=>i("error")),d.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=q.leaving;const s=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Q.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(a=>{r=new dt(this,Q.leave,{},e),r.receive("ok",()=>{s(),a("ok")}).receive("timeout",()=>{s(),a("timed out")}).receive("error",()=>{a("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r==null||r.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=q.closed,this.bindings={}}async _fetchWithTimeout(e,s,r){const a=new AbortController,i=setTimeout(()=>a.abort(),r),o=await this.socket.fetch(e,Object.assign(Object.assign({},s),{signal:a.signal}));return clearTimeout(i),o}_push(e,s,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let a=new dt(this,e,s,r);return this._canPush()?a.send():this._addToPushBuffer(a),a}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>La){const s=this.pushBuffer.shift();s&&(s.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${s.event}`,s.payload))}}_onMessage(e,s,r){return s}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,s,r){var a,i;const o=e.toLocaleLowerCase(),{close:l,error:c,leave:d,join:h}=Q;if(r&&[l,c,d,h].indexOf(o)>=0&&r!==this._joinRef())return;let f=this._onMessage(o,s,r);if(s&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(a=this.bindings.postgres_changes)===null||a===void 0||a.filter(g=>{var x,w,v;return((x=g.filter)===null||x===void 0?void 0:x.event)==="*"||((v=(w=g.filter)===null||w===void 0?void 0:w.event)===null||v===void 0?void 0:v.toLocaleLowerCase())===o}).map(g=>g.callback(f,r)):(i=this.bindings[o])===null||i===void 0||i.filter(g=>{var x,w,v,N,O,b;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in g){const y=g.id,C=(x=g.filter)===null||x===void 0?void 0:x.event;return y&&((w=s.ids)===null||w===void 0?void 0:w.includes(y))&&(C==="*"||(C==null?void 0:C.toLocaleLowerCase())===((v=s.data)===null||v===void 0?void 0:v.type.toLocaleLowerCase()))}else{const y=(O=(N=g==null?void 0:g.filter)===null||N===void 0?void 0:N.event)===null||O===void 0?void 0:O.toLocaleLowerCase();return y==="*"||y===((b=s==null?void 0:s.event)===null||b===void 0?void 0:b.toLocaleLowerCase())}else return g.type.toLocaleLowerCase()===o}).map(g=>{if(typeof f=="object"&&"ids"in f){const x=f.data,{schema:w,table:v,commit_timestamp:N,type:O,errors:b}=x;f=Object.assign(Object.assign({},{schema:w,table:v,commit_timestamp:N,eventType:O,new:{},old:{},errors:b}),this._getPayloadRecords(x))}g.callback(f,r)})}_isClosed(){return this.state===q.closed}_isJoined(){return this.state===q.joined}_isJoining(){return this.state===q.joining}_isLeaving(){return this.state===q.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,s,r){const a=e.toLocaleLowerCase(),i={type:a,filter:s,callback:r};return this.bindings[a]?this.bindings[a].push(i):this.bindings[a]=[i],this}_off(e,s){const r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(a=>{var i;return!(((i=a.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&Lt.isEqual(a.filter,s))})),this}static isEqual(e,s){if(Object.keys(e).length!==Object.keys(s).length)return!1;for(const r in e)if(e[r]!==s[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Q.close,{},e)}_onError(e){this._on(Q.error,{},s=>e(s))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=q.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const s={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(s.new=is(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(s.old=is(e.columns,e.old_record)),s}}const cs=()=>{},Me={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Va=[1e3,2e3,5e3,1e4],Wa=1e4,Ha=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Ka{constructor(e,s){var r;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=jt,this.transport=null,this.heartbeatIntervalMs=Me.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=cs,this.ref=0,this.reconnectTimer=null,this.logger=cs,this.conn=null,this.sendBuffer=[],this.serializer=new Da,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=a=>{let i;return a?i=a:typeof fetch>"u"?i=(...o)=>$e(async()=>{const{default:l}=await Promise.resolve().then(()=>_e);return{default:l}},void 0).then(({default:l})=>l(...o)).catch(l=>{throw new Error(`Failed to load @supabase/node-fetch: ${l.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):i=fetch,(...o)=>i(...o)},!(!((r=s==null?void 0:s.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=s.params.apikey,this.endPoint=`${e}/${_t.websocket}`,this.httpEndpoint=sr(e),this._initializeOptions(s),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(s==null?void 0:s.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Pa.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const s=e.message;throw s.includes("Node.js")?new Error(`${s}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${s}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Ra}))}disconnect(e,s){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},e?this.conn.close(e,s??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const s=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),s}async removeAllChannels(){const e=await Promise.all(this.channels.map(s=>s.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,s,r){this.logger(e,s,r)}connectionState(){switch(this.conn&&this.conn.readyState){case Ee.connecting:return ue.Connecting;case Ee.open:return ue.Open;case Ee.closing:return ue.Closing;default:return ue.Closed}}isConnected(){return this.connectionState()===ue.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,s={config:{}}){const r=`realtime:${e}`,a=this.getChannels().find(i=>i.topic===r);if(a)return a;{const i=new Lt(`realtime:${e}`,s,this);return this.channels.push(i),i}}push(e){const{topic:s,event:r,payload:a,ref:i}=e,o=()=>{this.encode(e,l=>{var c;(c=this.conn)===null||c===void 0||c.send(l)})};this.log("push",`${s} ${r} (${i})`,a),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(Ia,"heartbeat timeout"),setTimeout(()=>{var s;this.isConnected()||(s=this.reconnectTimer)===null||s===void 0||s.scheduleTimeout()},Me.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let s=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));s&&(this.log("transport",`leaving duplicate topic "${e}"`),s.unsubscribe())}_remove(e){this.channels=this.channels.filter(s=>s.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,s=>{s.topic==="phoenix"&&s.event==="phx_reply"&&this.heartbeatCallback(s.payload.status==="ok"?"ok":"error"),s.ref&&s.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:r,event:a,payload:i,ref:o}=s,l=o?`(${o})`:"",c=i.status||"";this.log("receive",`${c} ${r} ${a} ${l}`.trim(),i),this.channels.filter(d=>d._isMember(r)).forEach(d=>d._trigger(a,i,o)),this._triggerStateCallbacks("message",s)})}_clearTimer(e){var s;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((s=this.reconnectTimer)===null||s===void 0||s.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=s=>{this.log("worker","worker error",s.message),this.workerRef.terminate()},this.workerRef.onmessage=s=>{s.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var s;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(s=this.reconnectTimer)===null||s===void 0||s.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(Q.error))}_appendParams(e,s){if(Object.keys(s).length===0)return e;const r=e.match(/\?/)?"&":"?",a=new URLSearchParams(s);return`${e}${r}${a}`}_workerObjectUrl(e){let s;if(e)s=e;else{const r=new Blob([Ha],{type:"application/javascript"});s=URL.createObjectURL(r)}return s}_setConnectionState(e,s=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=s)}async _performAuth(e=null){let s;e?s=e:this.accessToken?s=await this.accessToken():s=this.accessTokenValue,this.accessTokenValue!=s&&(this.accessTokenValue=s,this.channels.forEach(r=>{const a={access_token:s,version:$a};s&&r.updateJoinPayload(a),r.joinedOnce&&r._isJoined()&&r._push(Q.access_token,{access_token:s})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(s=>{this.log("error",`error setting auth in ${e}`,s)})}_triggerStateCallbacks(e,s){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(s)}catch(a){this.log("error",`error in ${e} callback`,a)}})}catch(r){this.log("error",`error triggering ${e} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new er(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Me.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var s,r,a,i,o,l,c,d;if(this.transport=(s=e==null?void 0:e.transport)!==null&&s!==void 0?s:null,this.timeout=(r=e==null?void 0:e.timeout)!==null&&r!==void 0?r:jt,this.heartbeatIntervalMs=(a=e==null?void 0:e.heartbeatIntervalMs)!==null&&a!==void 0?a:Me.HEARTBEAT_INTERVAL,this.worker=(i=e==null?void 0:e.worker)!==null&&i!==void 0?i:!1,this.accessToken=(o=e==null?void 0:e.accessToken)!==null&&o!==void 0?o:null,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(l=e==null?void 0:e.reconnectAfterMs)!==null&&l!==void 0?l:h=>Va[h-1]||Wa,this.encode=(c=e==null?void 0:e.encode)!==null&&c!==void 0?c:(h,u)=>u(JSON.stringify(h)),this.decode=(d=e==null?void 0:e.decode)!==null&&d!==void 0?d:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}class Dt extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function F(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}class Ja extends Dt{constructor(e,s,r){super(e),this.name="StorageApiError",this.status=s,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class kt extends Dt{constructor(e,s){super(e),this.name="StorageUnknownError",this.originalError=s}}var Ga=function(n,e,s,r){function a(i){return i instanceof s?i:new s(function(o){o(i)})}return new(s||(s=Promise))(function(i,o){function l(h){try{d(r.next(h))}catch(u){o(u)}}function c(h){try{d(r.throw(h))}catch(u){o(u)}}function d(h){h.done?i(h.value):a(h.value).then(l,c)}d((r=r.apply(n,e||[])).next())})};const rr=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...s)=>$e(async()=>{const{default:r}=await Promise.resolve().then(()=>_e);return{default:r}},void 0).then(({default:r})=>r(...s)):e=fetch,(...s)=>e(...s)},Ya=()=>Ga(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield $e(()=>Promise.resolve().then(()=>_e),void 0)).Response:Response}),St=n=>{if(Array.isArray(n))return n.map(s=>St(s));if(typeof n=="function"||n!==Object(n))return n;const e={};return Object.entries(n).forEach(([s,r])=>{const a=s.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[a]=St(r)}),e},Qa=n=>{if(typeof n!="object"||n===null)return!1;const e=Object.getPrototypeOf(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)};var me=function(n,e,s,r){function a(i){return i instanceof s?i:new s(function(o){o(i)})}return new(s||(s=Promise))(function(i,o){function l(h){try{d(r.next(h))}catch(u){o(u)}}function c(h){try{d(r.throw(h))}catch(u){o(u)}}function d(h){h.done?i(h.value):a(h.value).then(l,c)}d((r=r.apply(n,e||[])).next())})};const ht=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),Xa=(n,e,s)=>me(void 0,void 0,void 0,function*(){const r=yield Ya();n instanceof r&&!(s!=null&&s.noResolveJson)?n.json().then(a=>{const i=n.status||500,o=(a==null?void 0:a.statusCode)||i+"";e(new Ja(ht(a),i,o))}).catch(a=>{e(new kt(ht(a),a))}):e(new kt(ht(n),n))}),Za=(n,e,s,r)=>{const a={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"||!r?a:(Qa(r)?(a.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),a.body=JSON.stringify(r)):a.body=r,e!=null&&e.duplex&&(a.duplex=e.duplex),Object.assign(Object.assign({},a),s))};function Ie(n,e,s,r,a,i){return me(this,void 0,void 0,function*(){return new Promise((o,l)=>{n(s,Za(e,r,a,i)).then(c=>{if(!c.ok)throw c;return r!=null&&r.noResolveJson?c:c.json()}).then(c=>o(c)).catch(c=>Xa(c,l,r))})})}function Ge(n,e,s,r){return me(this,void 0,void 0,function*(){return Ie(n,"GET",e,s,r)})}function Z(n,e,s,r,a){return me(this,void 0,void 0,function*(){return Ie(n,"POST",e,r,a,s)})}function Ct(n,e,s,r,a){return me(this,void 0,void 0,function*(){return Ie(n,"PUT",e,r,a,s)})}function en(n,e,s,r){return me(this,void 0,void 0,function*(){return Ie(n,"HEAD",e,Object.assign(Object.assign({},s),{noResolveJson:!0}),r)})}function ar(n,e,s,r,a){return me(this,void 0,void 0,function*(){return Ie(n,"DELETE",e,r,a,s)})}var H=function(n,e,s,r){function a(i){return i instanceof s?i:new s(function(o){o(i)})}return new(s||(s=Promise))(function(i,o){function l(h){try{d(r.next(h))}catch(u){o(u)}}function c(h){try{d(r.throw(h))}catch(u){o(u)}}function d(h){h.done?i(h.value):a(h.value).then(l,c)}d((r=r.apply(n,e||[])).next())})};const tn={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},ds={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class sn{constructor(e,s={},r,a){this.url=e,this.headers=s,this.bucketId=r,this.fetch=rr(a)}uploadOrUpdate(e,s,r,a){return H(this,void 0,void 0,function*(){try{let i;const o=Object.assign(Object.assign({},ds),a);let l=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const c=o.metadata;typeof Blob<"u"&&r instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),c&&i.append("metadata",this.encodeMetadata(c)),i.append("",r)):typeof FormData<"u"&&r instanceof FormData?(i=r,i.append("cacheControl",o.cacheControl),c&&i.append("metadata",this.encodeMetadata(c))):(i=r,l["cache-control"]=`max-age=${o.cacheControl}`,l["content-type"]=o.contentType,c&&(l["x-metadata"]=this.toBase64(this.encodeMetadata(c)))),a!=null&&a.headers&&(l=Object.assign(Object.assign({},l),a.headers));const d=this._removeEmptyFolders(s),h=this._getFinalPath(d),u=yield(e=="PUT"?Ct:Z)(this.fetch,`${this.url}/object/${h}`,i,Object.assign({headers:l},o!=null&&o.duplex?{duplex:o.duplex}:{}));return{data:{path:d,id:u.Id,fullPath:u.Key},error:null}}catch(i){if(F(i))return{data:null,error:i};throw i}})}upload(e,s,r){return H(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,s,r)})}uploadToSignedUrl(e,s,r,a){return H(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),o=this._getFinalPath(i),l=new URL(this.url+`/object/upload/sign/${o}`);l.searchParams.set("token",s);try{let c;const d=Object.assign({upsert:ds.upsert},a),h=Object.assign(Object.assign({},this.headers),{"x-upsert":String(d.upsert)});typeof Blob<"u"&&r instanceof Blob?(c=new FormData,c.append("cacheControl",d.cacheControl),c.append("",r)):typeof FormData<"u"&&r instanceof FormData?(c=r,c.append("cacheControl",d.cacheControl)):(c=r,h["cache-control"]=`max-age=${d.cacheControl}`,h["content-type"]=d.contentType);const u=yield Ct(this.fetch,l.toString(),c,{headers:h});return{data:{path:i,fullPath:u.Key},error:null}}catch(c){if(F(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(e,s){return H(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const a=Object.assign({},this.headers);s!=null&&s.upsert&&(a["x-upsert"]="true");const i=yield Z(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:a}),o=new URL(this.url+i.url),l=o.searchParams.get("token");if(!l)throw new Dt("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:l},error:null}}catch(r){if(F(r))return{data:null,error:r};throw r}})}update(e,s,r){return H(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,s,r)})}move(e,s,r){return H(this,void 0,void 0,function*(){try{return{data:yield Z(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:s,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(a){if(F(a))return{data:null,error:a};throw a}})}copy(e,s,r){return H(this,void 0,void 0,function*(){try{return{data:{path:(yield Z(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:s,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(a){if(F(a))return{data:null,error:a};throw a}})}createSignedUrl(e,s,r){return H(this,void 0,void 0,function*(){try{let a=this._getFinalPath(e),i=yield Z(this.fetch,`${this.url}/object/sign/${a}`,Object.assign({expiresIn:s},r!=null&&r.transform?{transform:r.transform}:{}),{headers:this.headers});const o=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(a){if(F(a))return{data:null,error:a};throw a}})}createSignedUrls(e,s,r){return H(this,void 0,void 0,function*(){try{const a=yield Z(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:s,paths:e},{headers:this.headers}),i=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:a.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${i}`):null})),error:null}}catch(a){if(F(a))return{data:null,error:a};throw a}})}download(e,s){return H(this,void 0,void 0,function*(){const a=typeof(s==null?void 0:s.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((s==null?void 0:s.transform)||{}),o=i?`?${i}`:"";try{const l=this._getFinalPath(e);return{data:yield(yield Ge(this.fetch,`${this.url}/${a}/${l}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(l){if(F(l))return{data:null,error:l};throw l}})}info(e){return H(this,void 0,void 0,function*(){const s=this._getFinalPath(e);try{const r=yield Ge(this.fetch,`${this.url}/object/info/${s}`,{headers:this.headers});return{data:St(r),error:null}}catch(r){if(F(r))return{data:null,error:r};throw r}})}exists(e){return H(this,void 0,void 0,function*(){const s=this._getFinalPath(e);try{return yield en(this.fetch,`${this.url}/object/${s}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(F(r)&&r instanceof kt){const a=r.originalError;if([400,404].includes(a==null?void 0:a.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,s){const r=this._getFinalPath(e),a=[],i=s!=null&&s.download?`download=${s.download===!0?"":s.download}`:"";i!==""&&a.push(i);const l=typeof(s==null?void 0:s.transform)<"u"?"render/image":"object",c=this.transformOptsToQueryString((s==null?void 0:s.transform)||{});c!==""&&a.push(c);let d=a.join("&");return d!==""&&(d=`?${d}`),{data:{publicUrl:encodeURI(`${this.url}/${l}/public/${r}${d}`)}}}remove(e){return H(this,void 0,void 0,function*(){try{return{data:yield ar(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(s){if(F(s))return{data:null,error:s};throw s}})}list(e,s,r){return H(this,void 0,void 0,function*(){try{const a=Object.assign(Object.assign(Object.assign({},tn),s),{prefix:e||""});return{data:yield Z(this.fetch,`${this.url}/object/list/${this.bucketId}`,a,{headers:this.headers},r),error:null}}catch(a){if(F(a))return{data:null,error:a};throw a}})}listV2(e,s){return H(this,void 0,void 0,function*(){try{const r=Object.assign({},e);return{data:yield Z(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,r,{headers:this.headers},s),error:null}}catch(r){if(F(r))return{data:null,error:r};throw r}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const s=[];return e.width&&s.push(`width=${e.width}`),e.height&&s.push(`height=${e.height}`),e.resize&&s.push(`resize=${e.resize}`),e.format&&s.push(`format=${e.format}`),e.quality&&s.push(`quality=${e.quality}`),s.join("&")}}const rn="2.11.0",an={"X-Client-Info":`storage-js/${rn}`};var ge=function(n,e,s,r){function a(i){return i instanceof s?i:new s(function(o){o(i)})}return new(s||(s=Promise))(function(i,o){function l(h){try{d(r.next(h))}catch(u){o(u)}}function c(h){try{d(r.throw(h))}catch(u){o(u)}}function d(h){h.done?i(h.value):a(h.value).then(l,c)}d((r=r.apply(n,e||[])).next())})};class nn{constructor(e,s={},r,a){const i=new URL(e);a!=null&&a.useNewHostname&&/supabase\.(co|in|red)$/.test(i.hostname)&&!i.hostname.includes("storage.supabase.")&&(i.hostname=i.hostname.replace("supabase.","storage.supabase.")),this.url=i.href,this.headers=Object.assign(Object.assign({},an),s),this.fetch=rr(r)}listBuckets(){return ge(this,void 0,void 0,function*(){try{return{data:yield Ge(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(F(e))return{data:null,error:e};throw e}})}getBucket(e){return ge(this,void 0,void 0,function*(){try{return{data:yield Ge(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(s){if(F(s))return{data:null,error:s};throw s}})}createBucket(e,s={public:!1}){return ge(this,void 0,void 0,function*(){try{return{data:yield Z(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:s.type,public:s.public,file_size_limit:s.fileSizeLimit,allowed_mime_types:s.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(F(r))return{data:null,error:r};throw r}})}updateBucket(e,s){return ge(this,void 0,void 0,function*(){try{return{data:yield Ct(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:s.public,file_size_limit:s.fileSizeLimit,allowed_mime_types:s.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(F(r))return{data:null,error:r};throw r}})}emptyBucket(e){return ge(this,void 0,void 0,function*(){try{return{data:yield Z(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(s){if(F(s))return{data:null,error:s};throw s}})}deleteBucket(e){return ge(this,void 0,void 0,function*(){try{return{data:yield ar(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(s){if(F(s))return{data:null,error:s};throw s}})}}class on extends nn{constructor(e,s={},r,a){super(e,s,r,a)}from(e){return new sn(this.url,this.headers,e,this.fetch)}}const ln="2.55.0";let Se="";typeof Deno<"u"?Se="deno":typeof document<"u"?Se="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Se="react-native":Se="node";const cn={"X-Client-Info":`supabase-js-${Se}/${ln}`},dn={headers:cn},hn={schema:"public"},un={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},mn={};var fn=function(n,e,s,r){function a(i){return i instanceof s?i:new s(function(o){o(i)})}return new(s||(s=Promise))(function(i,o){function l(h){try{d(r.next(h))}catch(u){o(u)}}function c(h){try{d(r.throw(h))}catch(u){o(u)}}function d(h){h.done?i(h.value):a(h.value).then(l,c)}d((r=r.apply(n,e||[])).next())})};const gn=n=>{let e;return n?e=n:typeof fetch>"u"?e=zs:e=fetch,(...s)=>e(...s)},pn=()=>typeof Headers>"u"?Vs:Headers,xn=(n,e,s)=>{const r=gn(s),a=pn();return(i,o)=>fn(void 0,void 0,void 0,function*(){var l;const c=(l=yield e())!==null&&l!==void 0?l:n;let d=new a(o==null?void 0:o.headers);return d.has("apikey")||d.set("apikey",n),d.has("Authorization")||d.set("Authorization",`Bearer ${c}`),r(i,Object.assign(Object.assign({},o),{headers:d}))})};var yn=function(n,e,s,r){function a(i){return i instanceof s?i:new s(function(o){o(i)})}return new(s||(s=Promise))(function(i,o){function l(h){try{d(r.next(h))}catch(u){o(u)}}function c(h){try{d(r.throw(h))}catch(u){o(u)}}function d(h){h.done?i(h.value):a(h.value).then(l,c)}d((r=r.apply(n,e||[])).next())})};function bn(n){return n.endsWith("/")?n:n+"/"}function vn(n,e){var s,r;const{db:a,auth:i,realtime:o,global:l}=n,{db:c,auth:d,realtime:h,global:u}=e,f={db:Object.assign(Object.assign({},c),a),auth:Object.assign(Object.assign({},d),i),realtime:Object.assign(Object.assign({},h),o),storage:{},global:Object.assign(Object.assign(Object.assign({},u),l),{headers:Object.assign(Object.assign({},(s=u==null?void 0:u.headers)!==null&&s!==void 0?s:{}),(r=l==null?void 0:l.headers)!==null&&r!==void 0?r:{})}),accessToken:()=>yn(this,void 0,void 0,function*(){return""})};return n.accessToken?f.accessToken=n.accessToken:delete f.accessToken,f}const nr="2.71.1",ve=30*1e3,Et=3,ut=Et*ve,wn="http://localhost:9999",jn="supabase.auth.token",_n={"X-Client-Info":`gotrue-js/${nr}`},Tt="X-Supabase-Api-Version",ir={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Nn=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,kn=10*60*1e3;class Ut extends Error{constructor(e,s,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=s,this.code=r}}function A(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class Sn extends Ut{constructor(e,s,r){super(e,s,r),this.name="AuthApiError",this.status=s,this.code=r}}function Cn(n){return A(n)&&n.name==="AuthApiError"}class or extends Ut{constructor(e,s){super(e),this.name="AuthUnknownError",this.originalError=s}}class le extends Ut{constructor(e,s,r,a){super(e,r,a),this.name=s,this.status=r}}class ie extends le{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function En(n){return A(n)&&n.name==="AuthSessionMissingError"}class qe extends le{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Fe extends le{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class ze extends le{constructor(e,s=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=s}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Tn(n){return A(n)&&n.name==="AuthImplicitGrantRedirectError"}class hs extends le{constructor(e,s=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=s}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class At extends le{constructor(e,s){super(e,"AuthRetryableFetchError",s,void 0)}}function mt(n){return A(n)&&n.name==="AuthRetryableFetchError"}class us extends le{constructor(e,s,r){super(e,"AuthWeakPasswordError",s,"weak_password"),this.reasons=r}}class Pt extends le{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Ye="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),ms=` 	
\r=`.split(""),An=(()=>{const n=new Array(128);for(let e=0;e<n.length;e+=1)n[e]=-1;for(let e=0;e<ms.length;e+=1)n[ms[e].charCodeAt(0)]=-2;for(let e=0;e<Ye.length;e+=1)n[Ye[e].charCodeAt(0)]=e;return n})();function fs(n,e,s){if(n!==null)for(e.queue=e.queue<<8|n,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;s(Ye[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;s(Ye[r]),e.queuedBits-=6}}function lr(n,e,s){const r=An[n];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)s(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function gs(n){const e=[],s=o=>{e.push(String.fromCodePoint(o))},r={utf8seq:0,codepoint:0},a={queue:0,queuedBits:0},i=o=>{$n(o,r,s)};for(let o=0;o<n.length;o+=1)lr(n.charCodeAt(o),a,i);return e.join("")}function Pn(n,e){if(n<=127){e(n);return}else if(n<=2047){e(192|n>>6),e(128|n&63);return}else if(n<=65535){e(224|n>>12),e(128|n>>6&63),e(128|n&63);return}else if(n<=1114111){e(240|n>>18),e(128|n>>12&63),e(128|n>>6&63),e(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function On(n,e){for(let s=0;s<n.length;s+=1){let r=n.charCodeAt(s);if(r>55295&&r<=56319){const a=(r-55296)*1024&65535;r=(n.charCodeAt(s+1)-56320&65535|a)+65536,s+=1}Pn(r,e)}}function $n(n,e,s){if(e.utf8seq===0){if(n<=127){s(n);return}for(let r=1;r<6;r+=1)if(!(n>>7-r&1)){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=n&31;else if(e.utf8seq===3)e.codepoint=n&15;else if(e.utf8seq===4)e.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|n&63,e.utf8seq-=1,e.utf8seq===0&&s(e.codepoint)}}function Rn(n){const e=[],s={queue:0,queuedBits:0},r=a=>{e.push(a)};for(let a=0;a<n.length;a+=1)lr(n.charCodeAt(a),s,r);return new Uint8Array(e)}function In(n){const e=[];return On(n,s=>e.push(s)),new Uint8Array(e)}function Ln(n){const e=[],s={queue:0,queuedBits:0},r=a=>{e.push(a)};return n.forEach(a=>fs(a,s,r)),fs(null,s,r),e.join("")}function Dn(n){return Math.round(Date.now()/1e3)+n}function Un(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const e=Math.random()*16|0;return(n=="x"?e:e&3|8).toString(16)})}const Y=()=>typeof window<"u"&&typeof document<"u",ce={tested:!1,writable:!1},cr=()=>{if(!Y())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(ce.tested)return ce.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),ce.tested=!0,ce.writable=!0}catch{ce.tested=!0,ce.writable=!1}return ce.writable};function Bn(n){const e={},s=new URL(n);if(s.hash&&s.hash[0]==="#")try{new URLSearchParams(s.hash.substring(1)).forEach((a,i)=>{e[i]=a})}catch{}return s.searchParams.forEach((r,a)=>{e[a]=r}),e}const dr=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...s)=>$e(async()=>{const{default:r}=await Promise.resolve().then(()=>_e);return{default:r}},void 0).then(({default:r})=>r(...s)):e=fetch,(...s)=>e(...s)},Mn=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",we=async(n,e,s)=>{await n.setItem(e,JSON.stringify(s))},de=async(n,e)=>{const s=await n.getItem(e);if(!s)return null;try{return JSON.parse(s)}catch{return s}},ne=async(n,e)=>{await n.removeItem(e)};class nt{constructor(){this.promise=new nt.promiseConstructor((e,s)=>{this.resolve=e,this.reject=s})}}nt.promiseConstructor=Promise;function ft(n){const e=n.split(".");if(e.length!==3)throw new Pt("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!Nn.test(e[r]))throw new Pt("JWT not in base64url format");return{header:JSON.parse(gs(e[0])),payload:JSON.parse(gs(e[1])),signature:Rn(e[2]),raw:{header:e[0],payload:e[1]}}}async function qn(n){return await new Promise(e=>{setTimeout(()=>e(null),n)})}function Fn(n,e){return new Promise((r,a)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await n(i);if(!e(i,null,o)){r(o);return}}catch(o){if(!e(i,o)){a(o);return}}})()})}function zn(n){return("0"+n.toString(16)).substr(-2)}function Vn(){const e=new Uint32Array(56);if(typeof crypto>"u"){const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=s.length;let a="";for(let i=0;i<56;i++)a+=s.charAt(Math.floor(Math.random()*r));return a}return crypto.getRandomValues(e),Array.from(e,zn).join("")}async function Wn(n){const s=new TextEncoder().encode(n),r=await crypto.subtle.digest("SHA-256",s),a=new Uint8Array(r);return Array.from(a).map(i=>String.fromCharCode(i)).join("")}async function Hn(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const s=await Wn(n);return btoa(s).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function pe(n,e,s=!1){const r=Vn();let a=r;s&&(a+="/PASSWORD_RECOVERY"),await we(n,`${e}-code-verifier`,a);const i=await Hn(r);return[i,r===i?"plain":"s256"]}const Kn=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Jn(n){const e=n.headers.get(Tt);if(!e||!e.match(Kn))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function Gn(n){if(!n)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(n<=e)throw new Error("JWT has expired")}function Yn(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Qn=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function xe(n){if(!Qn.test(n))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function gt(){const n={};return new Proxy(n,{get:(e,s)=>{if(s==="__isUserNotAvailableProxy")return!0;if(typeof s=="symbol"){const r=s.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${s}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,s)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${s}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,s)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${s}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function ps(n){return JSON.parse(JSON.stringify(n))}var Xn=function(n,e){var s={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(s[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,r=Object.getOwnPropertySymbols(n);a<r.length;a++)e.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(n,r[a])&&(s[r[a]]=n[r[a]]);return s};const he=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),Zn=[502,503,504];async function xs(n){var e;if(!Mn(n))throw new At(he(n),0);if(Zn.includes(n.status))throw new At(he(n),n.status);let s;try{s=await n.json()}catch(i){throw new or(he(i),i)}let r;const a=Jn(n);if(a&&a.getTime()>=ir["2024-01-01"].timestamp&&typeof s=="object"&&s&&typeof s.code=="string"?r=s.code:typeof s=="object"&&s&&typeof s.error_code=="string"&&(r=s.error_code),r){if(r==="weak_password")throw new us(he(s),n.status,((e=s.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new ie}else if(typeof s=="object"&&s&&typeof s.weak_password=="object"&&s.weak_password&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new us(he(s),n.status,s.weak_password.reasons);throw new Sn(he(s),n.status||500,r)}const ei=(n,e,s,r)=>{const a={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?a:(a.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),a.body=JSON.stringify(r),Object.assign(Object.assign({},a),s))};async function P(n,e,s,r){var a;const i=Object.assign({},r==null?void 0:r.headers);i[Tt]||(i[Tt]=ir["2024-01-01"].name),r!=null&&r.jwt&&(i.Authorization=`Bearer ${r.jwt}`);const o=(a=r==null?void 0:r.query)!==null&&a!==void 0?a:{};r!=null&&r.redirectTo&&(o.redirect_to=r.redirectTo);const l=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",c=await ti(n,e,s+l,{headers:i,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(c):{data:Object.assign({},c),error:null}}async function ti(n,e,s,r,a,i){const o=ei(e,r,a,i);let l;try{l=await n(s,Object.assign({},o))}catch(c){throw console.error(c),new At(he(c),0)}if(l.ok||await xs(l),r!=null&&r.noResolveJson)return l;try{return await l.json()}catch(c){await xs(c)}}function te(n){var e;let s=null;ni(n)&&(s=Object.assign({},n),n.expires_at||(s.expires_at=Dn(n.expires_in)));const r=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:s,user:r},error:null}}function ys(n){const e=te(n);return!e.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((s,r)=>s&&typeof r=="string",!0)&&(e.data.weak_password=n.weak_password),e}function oe(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function si(n){return{data:n,error:null}}function ri(n){const{action_link:e,email_otp:s,hashed_token:r,redirect_to:a,verification_type:i}=n,o=Xn(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),l={action_link:e,email_otp:s,hashed_token:r,redirect_to:a,verification_type:i},c=Object.assign({},o);return{data:{properties:l,user:c},error:null}}function ai(n){return n}function ni(n){return n.access_token&&n.refresh_token&&n.expires_in}const pt=["global","local","others"];var ii=function(n,e){var s={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(s[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,r=Object.getOwnPropertySymbols(n);a<r.length;a++)e.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(n,r[a])&&(s[r[a]]=n[r[a]]);return s};class oi{constructor({url:e="",headers:s={},fetch:r}){this.url=e,this.headers=s,this.fetch=dr(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,s=pt[0]){if(pt.indexOf(s)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${pt.join(", ")}`);try{return await P(this.fetch,"POST",`${this.url}/logout?scope=${s}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(A(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,s={}){try{return await P(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:s.data},headers:this.headers,redirectTo:s.redirectTo,xform:oe})}catch(r){if(A(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:s}=e,r=ii(e,["options"]),a=Object.assign(Object.assign({},r),s);return"newEmail"in r&&(a.new_email=r==null?void 0:r.newEmail,delete a.newEmail),await P(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:a,headers:this.headers,xform:ri,redirectTo:s==null?void 0:s.redirectTo})}catch(s){if(A(s))return{data:{properties:null,user:null},error:s};throw s}}async createUser(e){try{return await P(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:oe})}catch(s){if(A(s))return{data:{user:null},error:s};throw s}}async listUsers(e){var s,r,a,i,o,l,c;try{const d={nextPage:null,lastPage:0,total:0},h=await P(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(s=e==null?void 0:e.page)===null||s===void 0?void 0:s.toString())!==null&&r!==void 0?r:"",per_page:(i=(a=e==null?void 0:e.perPage)===null||a===void 0?void 0:a.toString())!==null&&i!==void 0?i:""},xform:ai});if(h.error)throw h.error;const u=await h.json(),f=(o=h.headers.get("x-total-count"))!==null&&o!==void 0?o:0,g=(c=(l=h.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&c!==void 0?c:[];return g.length>0&&(g.forEach(x=>{const w=parseInt(x.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(x.split(";")[1].split("=")[1]);d[`${v}Page`]=w}),d.total=parseInt(f)),{data:Object.assign(Object.assign({},u),d),error:null}}catch(d){if(A(d))return{data:{users:[]},error:d};throw d}}async getUserById(e){xe(e);try{return await P(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:oe})}catch(s){if(A(s))return{data:{user:null},error:s};throw s}}async updateUserById(e,s){xe(e);try{return await P(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:s,headers:this.headers,xform:oe})}catch(r){if(A(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,s=!1){xe(e);try{return await P(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:s},xform:oe})}catch(r){if(A(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){xe(e.userId);try{const{data:s,error:r}=await P(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:a=>({data:{factors:a},error:null})});return{data:s,error:r}}catch(s){if(A(s))return{data:null,error:s};throw s}}async _deleteFactor(e){xe(e.userId),xe(e.id);try{return{data:await P(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(s){if(A(s))return{data:null,error:s};throw s}}}function bs(n={}){return{getItem:e=>n[e]||null,setItem:(e,s)=>{n[e]=s},removeItem:e=>{delete n[e]}}}function li(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const ye={debug:!!(globalThis&&cr()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class hr extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class ci extends hr{}async function di(n,e,s){ye.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),ye.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(n,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async a=>{if(a){ye.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,a.name);try{return await s()}finally{ye.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,a.name)}}else{if(e===0)throw ye.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new ci(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(ye.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await s()}}))}li();const hi={url:wn,storageKey:jn,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:_n,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function vs(n,e,s){return await s()}const be={};class Oe{constructor(e){var s,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Oe.nextInstanceID,Oe.nextInstanceID+=1,this.instanceID>0&&Y()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const a=Object.assign(Object.assign({},hi),e);if(this.logDebugMessages=!!a.debug,typeof a.debug=="function"&&(this.logger=a.debug),this.persistSession=a.persistSession,this.storageKey=a.storageKey,this.autoRefreshToken=a.autoRefreshToken,this.admin=new oi({url:a.url,headers:a.headers,fetch:a.fetch}),this.url=a.url,this.headers=a.headers,this.fetch=dr(a.fetch),this.lock=a.lock||vs,this.detectSessionInUrl=a.detectSessionInUrl,this.flowType=a.flowType,this.hasCustomAuthorizationHeader=a.hasCustomAuthorizationHeader,a.lock?this.lock=a.lock:Y()&&(!((s=globalThis==null?void 0:globalThis.navigator)===null||s===void 0)&&s.locks)?this.lock=di:this.lock=vs,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(a.storage?this.storage=a.storage:cr()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=bs(this.memoryStorage)),a.userStorage&&(this.userStorage=a.userStorage)):(this.memoryStorage={},this.storage=bs(this.memoryStorage)),Y()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}get jwks(){var e,s;return(s=(e=be[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&s!==void 0?s:{keys:[]}}set jwks(e){be[this.storageKey]=Object.assign(Object.assign({},be[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,s;return(s=(e=be[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&s!==void 0?s:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){be[this.storageKey]=Object.assign(Object.assign({},be[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${nr}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const s=Bn(window.location.href);let r="none";if(this._isImplicitGrantCallback(s)?r="implicit":await this._isPKCECallback(s)&&(r="pkce"),Y()&&this.detectSessionInUrl&&r!=="none"){const{data:a,error:i}=await this._getSessionFromURL(s,r);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),Tn(i)){const c=(e=i.details)===null||e===void 0?void 0:e.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:o,redirectType:l}=a;return this._debug("#_initialize()","detected session in URL",o,"redirect type",l),await this._saveSession(o),setTimeout(async()=>{l==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(s){return A(s)?{error:s}:{error:new or("Unexpected error during initialization",s)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var s,r,a;try{const i=await P(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(s=e==null?void 0:e.options)===null||s===void 0?void 0:s.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(a=e==null?void 0:e.options)===null||a===void 0?void 0:a.captchaToken}},xform:te}),{data:o,error:l}=i;if(l||!o)return{data:{user:null,session:null},error:l};const c=o.session,d=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(i){if(A(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(e){var s,r,a;try{let i;if("email"in e){const{email:h,password:u,options:f}=e;let g=null,x=null;this.flowType==="pkce"&&([g,x]=await pe(this.storage,this.storageKey)),i=await P(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f==null?void 0:f.emailRedirectTo,body:{email:h,password:u,data:(s=f==null?void 0:f.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken},code_challenge:g,code_challenge_method:x},xform:te})}else if("phone"in e){const{phone:h,password:u,options:f}=e;i=await P(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:h,password:u,data:(r=f==null?void 0:f.data)!==null&&r!==void 0?r:{},channel:(a=f==null?void 0:f.channel)!==null&&a!==void 0?a:"sms",gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken}},xform:te})}else throw new Fe("You must provide either an email or phone number and a password");const{data:o,error:l}=i;if(l||!o)return{data:{user:null,session:null},error:l};const c=o.session,d=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(i){if(A(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{let s;if("email"in e){const{email:i,password:o,options:l}=e;s=await P(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:ys})}else if("phone"in e){const{phone:i,password:o,options:l}=e;s=await P(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:ys})}else throw new Fe("You must provide either an email or phone number and a password");const{data:r,error:a}=s;return a?{data:{user:null,session:null},error:a}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new qe}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:a})}catch(s){if(A(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithOAuth(e){var s,r,a,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(s=e.options)===null||s===void 0?void 0:s.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(a=e.options)===null||a===void 0?void 0:a.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:s}=e;if(s==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${s}"`)}async signInWithSolana(e){var s,r,a,i,o,l,c,d,h,u,f,g;let x,w;if("message"in e)x=e.message,w=e.signature;else{const{chain:v,wallet:N,statement:O,options:b}=e;let y;if(Y())if(typeof N=="object")y=N;else{const m=window;if("solana"in m&&typeof m.solana=="object"&&("signIn"in m.solana&&typeof m.solana.signIn=="function"||"signMessage"in m.solana&&typeof m.solana.signMessage=="function"))y=m.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof N!="object"||!(b!=null&&b.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");y=N}const C=new URL((s=b==null?void 0:b.url)!==null&&s!==void 0?s:window.location.href);if("signIn"in y&&y.signIn){const m=await y.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},b==null?void 0:b.signInWithSolana),{version:"1",domain:C.host,uri:C.href}),O?{statement:O}:null));let _;if(Array.isArray(m)&&m[0]&&typeof m[0]=="object")_=m[0];else if(m&&typeof m=="object"&&"signedMessage"in m&&"signature"in m)_=m;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in _&&"signature"in _&&(typeof _.signedMessage=="string"||_.signedMessage instanceof Uint8Array)&&_.signature instanceof Uint8Array)x=typeof _.signedMessage=="string"?_.signedMessage:new TextDecoder().decode(_.signedMessage),w=_.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in y)||typeof y.signMessage!="function"||!("publicKey"in y)||typeof y!="object"||!y.publicKey||!("toBase58"in y.publicKey)||typeof y.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");x=[`${C.host} wants you to sign in with your Solana account:`,y.publicKey.toBase58(),...O?["",O,""]:[""],"Version: 1",`URI: ${C.href}`,`Issued At: ${(a=(r=b==null?void 0:b.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&a!==void 0?a:new Date().toISOString()}`,...!((i=b==null?void 0:b.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${b.signInWithSolana.notBefore}`]:[],...!((o=b==null?void 0:b.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${b.signInWithSolana.expirationTime}`]:[],...!((l=b==null?void 0:b.signInWithSolana)===null||l===void 0)&&l.chainId?[`Chain ID: ${b.signInWithSolana.chainId}`]:[],...!((c=b==null?void 0:b.signInWithSolana)===null||c===void 0)&&c.nonce?[`Nonce: ${b.signInWithSolana.nonce}`]:[],...!((d=b==null?void 0:b.signInWithSolana)===null||d===void 0)&&d.requestId?[`Request ID: ${b.signInWithSolana.requestId}`]:[],...!((u=(h=b==null?void 0:b.signInWithSolana)===null||h===void 0?void 0:h.resources)===null||u===void 0)&&u.length?["Resources",...b.signInWithSolana.resources.map(_=>`- ${_}`)]:[]].join(`
`);const m=await y.signMessage(new TextEncoder().encode(x),"utf8");if(!m||!(m instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");w=m}}try{const{data:v,error:N}=await P(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:x,signature:Ln(w)},!((f=e.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(g=e.options)===null||g===void 0?void 0:g.captchaToken}}:null),xform:te});if(N)throw N;return!v||!v.session||!v.user?{data:{user:null,session:null},error:new qe}:(v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),{data:Object.assign({},v),error:N})}catch(v){if(A(v))return{data:{user:null,session:null},error:v};throw v}}async _exchangeCodeForSession(e){const s=await de(this.storage,`${this.storageKey}-code-verifier`),[r,a]=(s??"").split("/");try{const{data:i,error:o}=await P(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:te});if(await ne(this.storage,`${this.storageKey}-code-verifier`),o)throw o;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new qe}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:a??null}),error:o})}catch(i){if(A(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(e){try{const{options:s,provider:r,token:a,access_token:i,nonce:o}=e,l=await P(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:a,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:s==null?void 0:s.captchaToken}},xform:te}),{data:c,error:d}=l;return d?{data:{user:null,session:null},error:d}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new qe}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:d})}catch(s){if(A(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithOtp(e){var s,r,a,i,o;try{if("email"in e){const{email:l,options:c}=e;let d=null,h=null;this.flowType==="pkce"&&([d,h]=await pe(this.storage,this.storageKey));const{error:u}=await P(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:l,data:(s=c==null?void 0:c.data)!==null&&s!==void 0?s:{},create_user:(r=c==null?void 0:c.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:d,code_challenge_method:h},redirectTo:c==null?void 0:c.emailRedirectTo});return{data:{user:null,session:null},error:u}}if("phone"in e){const{phone:l,options:c}=e,{data:d,error:h}=await P(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:l,data:(a=c==null?void 0:c.data)!==null&&a!==void 0?a:{},create_user:(i=c==null?void 0:c.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(o=c==null?void 0:c.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:d==null?void 0:d.message_id},error:h}}throw new Fe("You must provide either an email or phone number.")}catch(l){if(A(l))return{data:{user:null,session:null},error:l};throw l}}async verifyOtp(e){var s,r;try{let a,i;"options"in e&&(a=(s=e.options)===null||s===void 0?void 0:s.redirectTo,i=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:o,error:l}=await P(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:a,xform:te});if(l)throw l;if(!o)throw new Error("An error occurred on token verification.");const c=o.session,d=o.user;return c!=null&&c.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(a){if(A(a))return{data:{user:null,session:null},error:a};throw a}}async signInWithSSO(e){var s,r,a;try{let i=null,o=null;return this.flowType==="pkce"&&([i,o]=await pe(this.storage,this.storageKey)),await P(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(s=e.options)===null||s===void 0?void 0:s.redirectTo)!==null&&r!==void 0?r:void 0}),!((a=e==null?void 0:e.options)===null||a===void 0)&&a.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:o}),headers:this.headers,xform:si})}catch(i){if(A(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:s},error:r}=e;if(r)throw r;if(!s)throw new ie;const{error:a}=await P(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:s.access_token});return{data:{user:null,session:null},error:a}})}catch(e){if(A(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const s=`${this.url}/resend`;if("email"in e){const{email:r,type:a,options:i}=e,{error:o}=await P(this.fetch,"POST",s,{headers:this.headers,body:{email:r,type:a,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:r,type:a,options:i}=e,{data:o,error:l}=await P(this.fetch,"POST",s,{headers:this.headers,body:{phone:r,type:a,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:l}}throw new Fe("You must provide either an email or phone number and a type")}catch(s){if(A(s))return{data:{user:null,session:null},error:s};throw s}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async s=>s))}async _acquireLock(e,s){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),a=(async()=>(await r,await s()))();return this.pendingInLock.push((async()=>{try{await a}catch{}})()),a}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=s();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const a=[...this.pendingInLock];await Promise.all(a),this.pendingInLock.splice(0,a.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const s=await this.__loadSession();return await e(s)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const s=await de(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",s),s!==null&&(this._isValidSession(s)?e=s:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<ut:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const o=await de(this.userStorage,this.storageKey+"-user");o!=null&&o.user?e.user=o.user:e.user=gt()}if(this.storage.isServer&&e.user){let o=this.suppressGetSessionWarning;e=new Proxy(e,{get:(c,d,h)=>(!o&&d==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),o=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,d,h))})}return{data:{session:e},error:null}}const{session:a,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:a},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await P(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:oe}):await this._useSession(async s=>{var r,a,i;const{data:o,error:l}=s;if(l)throw l;return!(!((r=o.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new ie}:await P(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(a=o.session)===null||a===void 0?void 0:a.access_token)!==null&&i!==void 0?i:void 0,xform:oe})})}catch(s){if(A(s))return En(s)&&(await this._removeSession(),await ne(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:s};throw s}}async updateUser(e,s={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,s))}async _updateUser(e,s={}){try{return await this._useSession(async r=>{const{data:a,error:i}=r;if(i)throw i;if(!a.session)throw new ie;const o=a.session;let l=null,c=null;this.flowType==="pkce"&&e.email!=null&&([l,c]=await pe(this.storage,this.storageKey));const{data:d,error:h}=await P(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:s==null?void 0:s.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:l,code_challenge_method:c}),jwt:o.access_token,xform:oe});if(h)throw h;return o.user=d.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(r){if(A(r))return{data:{user:null},error:r};throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new ie;const s=Date.now()/1e3;let r=s,a=!0,i=null;const{payload:o}=ft(e.access_token);if(o.exp&&(r=o.exp,a=r<=s),a){const{session:l,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!l)return{data:{user:null,session:null},error:null};i=l}else{const{data:l,error:c}=await this._getUser(e.access_token);if(c)throw c;i={access_token:e.access_token,refresh_token:e.refresh_token,user:l.user,token_type:"bearer",expires_in:r-s,expires_at:r},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(s){if(A(s))return{data:{session:null,user:null},error:s};throw s}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async s=>{var r;if(!e){const{data:o,error:l}=s;if(l)throw l;e=(r=o.session)!==null&&r!==void 0?r:void 0}if(!(e!=null&&e.refresh_token))throw new ie;const{session:a,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:a?{data:{user:a.user,session:a},error:null}:{data:{user:null,session:null},error:null}})}catch(s){if(A(s))return{data:{user:null,session:null},error:s};throw s}}async _getSessionFromURL(e,s){try{if(!Y())throw new ze("No browser detected.");if(e.error||e.error_description||e.error_code)throw new ze(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(s){case"implicit":if(this.flowType==="pkce")throw new hs("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new ze("Not a valid implicit grant flow url.");break;default:}if(s==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new hs("No code detected.");const{data:O,error:b}=await this._exchangeCodeForSession(e.code);if(b)throw b;const y=new URL(window.location.href);return y.searchParams.delete("code"),window.history.replaceState(window.history.state,"",y.toString()),{data:{session:O.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:a,access_token:i,refresh_token:o,expires_in:l,expires_at:c,token_type:d}=e;if(!i||!l||!o||!d)throw new ze("No session defined in URL");const h=Math.round(Date.now()/1e3),u=parseInt(l);let f=h+u;c&&(f=parseInt(c));const g=f-h;g*1e3<=ve&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${g}s, should have been closer to ${u}s`);const x=f-u;h-x>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",x,f,h):h-x<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",x,f,h);const{data:w,error:v}=await this._getUser(i);if(v)throw v;const N={provider_token:r,provider_refresh_token:a,access_token:i,expires_in:u,expires_at:f,refresh_token:o,token_type:d,user:w.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:N,redirectType:e.type},error:null}}catch(r){if(A(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const s=await de(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&s)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async s=>{var r;const{data:a,error:i}=s;if(i)return{error:i};const o=(r=a.session)===null||r===void 0?void 0:r.access_token;if(o){const{error:l}=await this.admin.signOut(o,e);if(l&&!(Cn(l)&&(l.status===404||l.status===401||l.status===403)))return{error:l}}return e!=="others"&&(await this._removeSession(),await ne(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const s=Un(),r={id:s,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",s),this.stateChangeEmitters.delete(s)}};return this._debug("#onAuthStateChange()","registered callback with id",s),this.stateChangeEmitters.set(s,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(s)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async s=>{var r,a;try{const{data:{session:i},error:o}=s;if(o)throw o;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((a=this.stateChangeEmitters.get(e))===null||a===void 0?void 0:a.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,s={}){let r=null,a=null;this.flowType==="pkce"&&([r,a]=await pe(this.storage,this.storageKey,!0));try{return await P(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:a,gotrue_meta_security:{captcha_token:s.captchaToken}},headers:this.headers,redirectTo:s.redirectTo})}catch(i){if(A(i))return{data:null,error:i};throw i}}async getUserIdentities(){var e;try{const{data:s,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=s.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(s){if(A(s))return{data:null,error:s};throw s}}async linkIdentity(e){var s;try{const{data:r,error:a}=await this._useSession(async i=>{var o,l,c,d,h;const{data:u,error:f}=i;if(f)throw f;const g=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(l=e.options)===null||l===void 0?void 0:l.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await P(this.fetch,"GET",g,{headers:this.headers,jwt:(h=(d=u.session)===null||d===void 0?void 0:d.access_token)!==null&&h!==void 0?h:void 0})});if(a)throw a;return Y()&&!(!((s=e.options)===null||s===void 0)&&s.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),{data:{provider:e.provider,url:r==null?void 0:r.url},error:null}}catch(r){if(A(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async s=>{var r,a;const{data:i,error:o}=s;if(o)throw o;return await P(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(a=(r=i.session)===null||r===void 0?void 0:r.access_token)!==null&&a!==void 0?a:void 0})})}catch(s){if(A(s))return{data:null,error:s};throw s}}async _refreshAccessToken(e){const s=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{const r=Date.now();return await Fn(async a=>(a>0&&await qn(200*Math.pow(2,a-1)),this._debug(s,"refreshing attempt",a),await P(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:te})),(a,i)=>{const o=200*Math.pow(2,a);return i&&mt(i)&&Date.now()+o-r<ve})}catch(r){if(this._debug(s,"error",r),A(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(s,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,s){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:s.redirectTo,scopes:s.scopes,queryParams:s.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",s,"url",r),Y()&&!s.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,s;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const a=await de(this.storage,this.storageKey);if(a&&this.userStorage){let o=await de(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:a.user},await we(this.userStorage,this.storageKey+"-user",o)),a.user=(e=o==null?void 0:o.user)!==null&&e!==void 0?e:gt()}else if(a&&!a.user&&!a.user){const o=await de(this.storage,this.storageKey+"-user");o&&(o!=null&&o.user)?(a.user=o.user,await ne(this.storage,this.storageKey+"-user"),await we(this.storage,this.storageKey,a)):a.user=gt()}if(this._debug(r,"session from storage",a),!this._isValidSession(a)){this._debug(r,"session is not valid"),a!==null&&await this._removeSession();return}const i=((s=a.expires_at)!==null&&s!==void 0?s:1/0)*1e3-Date.now()<ut;if(this._debug(r,`session has${i?"":" not"} expired with margin of ${ut}s`),i){if(this.autoRefreshToken&&a.refresh_token){const{error:o}=await this._callRefreshToken(a.refresh_token);o&&(console.error(o),mt(o)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(a.user&&a.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:l}=await this._getUser(a.access_token);!l&&(o!=null&&o.user)?(a.user=o.user,await this._saveSession(a),await this._notifyAllSubscribers("SIGNED_IN",a)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(r,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",a)}catch(a){this._debug(r,"error",a),console.error(a);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var s,r;if(!e)throw new ie;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const a=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(a,"begin");try{this.refreshingDeferred=new nt;const{data:i,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new ie;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const l={session:i.session,error:null};return this.refreshingDeferred.resolve(l),l}catch(i){if(this._debug(a,"error",i),A(i)){const o={session:null,error:i};return mt(i)||await this._removeSession(),(s=this.refreshingDeferred)===null||s===void 0||s.resolve(o),o}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(i),i}finally{this.refreshingDeferred=null,this._debug(a,"end")}}async _notifyAllSubscribers(e,s,r=!0){const a=`#_notifyAllSubscribers(${e})`;this._debug(a,"begin",s,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:s});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async l=>{try{await l.callback(e,s)}catch(c){i.push(c)}});if(await Promise.all(o),i.length>0){for(let l=0;l<i.length;l+=1)console.error(i[l]);throw i[0]}}finally{this._debug(a,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const s=Object.assign({},e),r=s.user&&s.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&s.user&&await we(this.userStorage,this.storageKey+"-user",{user:s.user});const a=Object.assign({},s);delete a.user;const i=ps(a);await we(this.storage,this.storageKey,i)}else{const a=ps(s);await we(this.storage,this.storageKey,a)}}async _removeSession(){this._debug("#_removeSession()"),await ne(this.storage,this.storageKey),await ne(this.storage,this.storageKey+"-code-verifier"),await ne(this.storage,this.storageKey+"-user"),this.userStorage&&await ne(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Y()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(s){console.error("removing visibilitychange callback failed",s)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),ve);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async s=>{const{data:{session:r}}=s;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const a=Math.floor((r.expires_at*1e3-e)/ve);this._debug("#_autoRefreshTokenTick()",`access token expires in ${a} ticks, a tick lasts ${ve}ms, refresh threshold is ${Et} ticks`),a<=Et&&await this._callRefreshToken(r.refresh_token)})}catch(s){console.error("Auto refresh tick failed with error. This is likely a transient error.",s)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof hr)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Y()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const s=`#_onVisibilityChanged(${e})`;this._debug(s,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(s,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,s,r){const a=[`provider=${encodeURIComponent(s)}`];if(r!=null&&r.redirectTo&&a.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&a.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[i,o]=await pe(this.storage,this.storageKey),l=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});a.push(l.toString())}if(r!=null&&r.queryParams){const i=new URLSearchParams(r.queryParams);a.push(i.toString())}return r!=null&&r.skipBrowserRedirect&&a.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${a.join("&")}`}async _unenroll(e){try{return await this._useSession(async s=>{var r;const{data:a,error:i}=s;return i?{data:null,error:i}:await P(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=a==null?void 0:a.session)===null||r===void 0?void 0:r.access_token})})}catch(s){if(A(s))return{data:null,error:s};throw s}}async _enroll(e){try{return await this._useSession(async s=>{var r,a;const{data:i,error:o}=s;if(o)return{data:null,error:o};const l=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:c,error:d}=await P(this.fetch,"POST",`${this.url}/factors`,{body:l,headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token});return d?{data:null,error:d}:(e.factorType==="totp"&&(!((a=c==null?void 0:c.totp)===null||a===void 0)&&a.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(s){if(A(s))return{data:null,error:s};throw s}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async s=>{var r;const{data:a,error:i}=s;if(i)return{data:null,error:i};const{data:o,error:l}=await P(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=a==null?void 0:a.session)===null||r===void 0?void 0:r.access_token});return l?{data:null,error:l}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:l})})}catch(s){if(A(s))return{data:null,error:s};throw s}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async s=>{var r;const{data:a,error:i}=s;return i?{data:null,error:i}:await P(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(r=a==null?void 0:a.session)===null||r===void 0?void 0:r.access_token})})}catch(s){if(A(s))return{data:null,error:s};throw s}})}async _challengeAndVerify(e){const{data:s,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:s.id,code:e.code})}async _listFactors(){const{data:{user:e},error:s}=await this.getUser();if(s)return{data:null,error:s};const r=(e==null?void 0:e.factors)||[],a=r.filter(o=>o.factor_type==="totp"&&o.status==="verified"),i=r.filter(o=>o.factor_type==="phone"&&o.status==="verified");return{data:{all:r,totp:a,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var s,r;const{data:{session:a},error:i}=e;if(i)return{data:null,error:i};if(!a)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=ft(a.access_token);let l=null;o.aal&&(l=o.aal);let c=l;((r=(s=a.user.factors)===null||s===void 0?void 0:s.filter(u=>u.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(c="aal2");const h=o.amr||[];return{data:{currentLevel:l,nextLevel:c,currentAuthenticationMethods:h},error:null}}))}async fetchJwk(e,s={keys:[]}){let r=s.keys.find(l=>l.kid===e);if(r)return r;const a=Date.now();if(r=this.jwks.keys.find(l=>l.kid===e),r&&this.jwks_cached_at+kn>a)return r;const{data:i,error:o}=await P(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=a,r=i.keys.find(l=>l.kid===e),!r)?null:r}async getClaims(e,s={}){try{let r=e;if(!r){const{data:g,error:x}=await this.getSession();if(x||!g.session)return{data:null,error:x};r=g.session.access_token}const{header:a,payload:i,signature:o,raw:{header:l,payload:c}}=ft(r);s!=null&&s.allowExpired||Gn(i.exp);const d=!a.alg||a.alg.startsWith("HS")||!a.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(a.kid,s!=null&&s.keys?{keys:s.keys}:s==null?void 0:s.jwks);if(!d){const{error:g}=await this.getUser(r);if(g)throw g;return{data:{claims:i,header:a,signature:o},error:null}}const h=Yn(a.alg),u=await crypto.subtle.importKey("jwk",d,h,!0,["verify"]);if(!await crypto.subtle.verify(h,u,o,In(`${l}.${c}`)))throw new Pt("Invalid JWT signature");return{data:{claims:i,header:a,signature:o},error:null}}catch(r){if(A(r))return{data:null,error:r};throw r}}}Oe.nextInstanceID=0;const ui=Oe;class mi extends ui{constructor(e){super(e)}}var fi=function(n,e,s,r){function a(i){return i instanceof s?i:new s(function(o){o(i)})}return new(s||(s=Promise))(function(i,o){function l(h){try{d(r.next(h))}catch(u){o(u)}}function c(h){try{d(r.throw(h))}catch(u){o(u)}}function d(h){h.done?i(h.value):a(h.value).then(l,c)}d((r=r.apply(n,e||[])).next())})};class gi{constructor(e,s,r){var a,i,o;if(this.supabaseUrl=e,this.supabaseKey=s,!e)throw new Error("supabaseUrl is required.");if(!s)throw new Error("supabaseKey is required.");const l=bn(e),c=new URL(l);this.realtimeUrl=new URL("realtime/v1",c),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",c),this.storageUrl=new URL("storage/v1",c),this.functionsUrl=new URL("functions/v1",c);const d=`sb-${c.hostname.split(".")[0]}-auth-token`,h={db:hn,realtime:mn,auth:Object.assign(Object.assign({},un),{storageKey:d}),global:dn},u=vn(r??{},h);this.storageKey=(a=u.auth.storageKey)!==null&&a!==void 0?a:"",this.headers=(i=u.global.headers)!==null&&i!==void 0?i:{},u.accessToken?(this.accessToken=u.accessToken,this.auth=new Proxy({},{get:(f,g)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(g)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=u.auth)!==null&&o!==void 0?o:{},this.headers,u.global.fetch),this.fetch=xn(s,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},u.realtime)),this.rest=new Aa(new URL("rest/v1",c).href,{headers:this.headers,schema:u.db.schema,fetch:this.fetch}),this.storage=new on(this.storageUrl.href,this.headers,this.fetch,r==null?void 0:r.storage),u.accessToken||this._listenForAuthEvents()}get functions(){return new ia(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,s={},r={}){return this.rest.rpc(e,s,r)}channel(e,s={config:{}}){return this.realtime.channel(e,s)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,s;return fi(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(s=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&s!==void 0?s:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:s,detectSessionInUrl:r,storage:a,storageKey:i,flowType:o,lock:l,debug:c},d,h){const u={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new mi({url:this.authUrl.href,headers:Object.assign(Object.assign({},u),d),storageKey:i,autoRefreshToken:e,persistSession:s,detectSessionInUrl:r,storage:a,flowType:o,lock:l,debug:c,fetch:h,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new Ka(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((s,r)=>{this._handleTokenChanged(s,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(e,s,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:e==="SIGNED_OUT"&&(this.realtime.setAuth(),s=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const pi=(n,e,s)=>new gi(n,e,s);function xi(){if(typeof window<"u"||typeof process>"u")return!1;const n=process.version;if(n==null)return!1;const e=n.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}xi()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const yi="https://ooaolhxjtaljsqwfnyov.supabase.co",bi="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9vYW9saHhqdGFsanNxd2ZueW92Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUxOTU5MTgsImV4cCI6MjA3MDc3MTkxOH0.uRc1Dnhune9h5KknKZkNQZ1ojVIjzgVuLS3oUEvHxB0",V=pi(yi,bi),ur=j.createContext(void 0);function Le(){const n=j.useContext(ur);if(!n)throw new Error("useCart must be used within CartProvider");return n}function vi({children:n}){const[e,s]=j.useState([]),[r,a]=j.useState(!1),[i]=j.useState(()=>{let g=sessionStorage.getItem("cartSessionId");return g||(g=crypto.randomUUID(),sessionStorage.setItem("cartSessionId",g)),g}),o=e.reduce((g,x)=>g+x.quantity,0),l=e.reduce((g,x)=>g+x.price*x.quantity,0),c=async()=>{try{a(!0);const{data:g,error:x}=await V.functions.invoke("cart-management",{body:{action:"GET_CART",sessionId:i}});if(x){console.error("Cart refresh error:",x);return}g!=null&&g.data&&s(g.data.items||[])}catch(g){console.error("Failed to refresh cart:",g)}finally{a(!1)}},d=async(g,x,w=1)=>{try{a(!0);const{data:v,error:N}=await V.functions.invoke("cart-management",{body:{action:"ADD_ITEM",sessionId:i,productId:g,variantId:x,quantity:w}});if(N)throw N;v!=null&&v.data&&s(v.data.items||[])}catch(v){throw console.error("Add to cart error:",v),v}finally{a(!1)}},h=async(g,x)=>{try{a(!0);const{data:w,error:v}=await V.functions.invoke("cart-management",{body:{action:"REMOVE_ITEM",sessionId:i,productId:g,variantId:x}});if(v)throw v;w!=null&&w.data&&s(w.data.items||[])}catch(w){throw console.error("Remove from cart error:",w),w}finally{a(!1)}},u=async(g,x,w)=>{if(w<=0){await h(g,x);return}try{a(!0),await h(g,x),await d(g,x,w)}catch(v){throw console.error("Update quantity error:",v),v}finally{a(!1)}},f=async()=>{try{a(!0);const{data:g,error:x}=await V.functions.invoke("cart-management",{body:{action:"CLEAR_CART",sessionId:i}});if(x)throw x;s([])}catch(g){throw console.error("Clear cart error:",g),g}finally{a(!1)}};return j.useEffect(()=>{c()},[]),t.jsx(ur.Provider,{value:{items:e,totalItems:o,totalAmount:l,sessionId:i,loading:r,addToCart:d,removeFromCart:h,updateQuantity:u,clearCart:f,refreshCart:c},children:n})}function wi({isOpen:n,onClose:e,onCheckout:s}){const{items:r,totalItems:a,totalAmount:i,loading:o,updateQuantity:l,removeFromCart:c}=Le(),[d,h]=j.useState(null);if(!n)return null;const u=async(g,x,w)=>{const v=`${g}-${x||"default"}`;try{h(v),await l(g,x,w)}catch(N){console.error("Failed to update quantity:",N)}finally{h(null)}},f=async(g,x)=>{const w=`${g}-${x||"default"}`;try{h(w),await c(g,x)}catch(v){console.error("Failed to remove item:",v)}finally{h(null)}};return t.jsxs("div",{className:"fixed inset-0 z-50 flex",children:[t.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm",onClick:e}),t.jsxs("div",{className:"ml-auto h-full w-full max-w-md bg-white shadow-2xl flex flex-col",children:[t.jsxs("div",{className:"flex items-center justify-between p-4 border-b bg-gradient-to-r from-blue-600 to-indigo-700",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(ae,{className:"h-6 w-6 text-white"}),t.jsx("h2",{className:"text-lg font-semibold text-white",children:"Shopping Cart"}),a>0&&t.jsxs(D,{variant:"secondary",className:"bg-white/20 text-white border-white/30",children:[a," ",a===1?"item":"items"]})]}),t.jsx(S,{variant:"ghost",size:"icon",onClick:e,className:"text-white hover:bg-white/20",children:t.jsx(Ot,{className:"h-5 w-5"})})]}),t.jsx("div",{className:"flex-1 overflow-hidden flex flex-col",children:o?t.jsx("div",{className:"flex-1 flex items-center justify-center",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),t.jsx("p",{className:"text-gray-600",children:"Loading cart..."})]})}):r.length===0?t.jsx("div",{className:"flex-1 flex items-center justify-center text-center p-8",children:t.jsxs("div",{children:[t.jsx(ae,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Your cart is empty"}),t.jsx("p",{className:"text-gray-600",children:"Add some products to get started!"})]})}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:r.map(g=>{const x=`${g.product_id}-${g.variant_id||"default"}`,w=d===x;return t.jsx(T,{className:`transition-opacity ${w?"opacity-50":""}`,children:t.jsx(E,{className:"p-4",children:t.jsxs("div",{className:"flex gap-4",children:[g.product_image_url?t.jsx("img",{src:g.product_image_url,alt:g.product_name,className:"w-16 h-16 object-cover rounded-lg bg-gray-100"}):t.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-gray-200 to-gray-300 rounded-lg flex items-center justify-center",children:t.jsx(ae,{className:"h-6 w-6 text-gray-400"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h4",{className:"font-medium text-gray-900 truncate",children:g.product_name}),g.variant_name&&t.jsx("p",{className:"text-sm text-gray-600",children:g.variant_name}),t.jsx("p",{className:"text-lg font-semibold text-blue-600 mt-1",children:M(g.price)}),t.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[t.jsxs("div",{className:"flex items-center border rounded-lg",children:[t.jsx(S,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>u(g.product_id,g.variant_id,g.quantity-1),disabled:w||g.quantity<=1,children:t.jsx(br,{className:"h-3 w-3"})}),t.jsx("span",{className:"px-3 py-1 text-sm font-medium min-w-[2rem] text-center",children:g.quantity}),t.jsx(S,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>u(g.product_id,g.variant_id,g.quantity+1),disabled:w,children:t.jsx(Je,{className:"h-3 w-3"})})]}),t.jsx(S,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-600 hover:text-red-700 hover:bg-red-50",onClick:()=>f(g.product_id,g.variant_id),disabled:w,children:t.jsx(vr,{className:"h-3 w-3"})})]})]}),t.jsx("div",{className:"text-right",children:t.jsx("p",{className:"text-lg font-semibold text-gray-900",children:M(g.price*g.quantity)})})]})})},x)})}),t.jsxs("div",{className:"border-t bg-gray-50 p-4 space-y-4",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-lg font-medium text-gray-900",children:"Total:"}),t.jsx("span",{className:"text-2xl font-bold text-blue-600",children:M(i)})]}),t.jsx(S,{onClick:s,className:"w-full bg-gradient-to-r from-emerald-600 to-green-700 hover:from-emerald-700 hover:to-green-800 text-white font-semibold py-3",disabled:o||a===0,children:"Proceed to Checkout"}),t.jsx(S,{variant:"outline",onClick:e,className:"w-full",children:"Continue Shopping"})]})]})})]})]})}function ji({onSuccess:n,onBack:e}){const{items:s,totalAmount:r,sessionId:a,clearCart:i}=Le(),[o,l]=j.useState(!1),[c,d]=j.useState("customer"),[h,u]=j.useState(null),[f,g]=j.useState({email:"",firstName:"",lastName:"",phone:"",address:"",city:"",state:"",zipCode:"",country:"US"}),[x,w]=j.useState({cardNumber:"",expiryMonth:"",expiryYear:"",cvv:"",cardholderName:""}),v=m=>m.replace(/\D/g,"").replace(/(\d{4})/g,"$1 ").trim().slice(0,19),N=(m,_)=>{g(p=>({...p,[m]:_})),u(null)},O=(m,_)=>{let p=_;m==="cardNumber"?p=v(_):m==="expiryMonth"||m==="expiryYear"?p=_.replace(/\D/g,"").slice(0,m==="expiryMonth"?2:4):m==="cvv"&&(p=_.replace(/\D/g,"").slice(0,4)),w(k=>({...k,[m]:p})),u(null)},b=()=>{const m=["email","firstName","lastName","phone","address","city","state","zipCode"];for(const p of m)if(!f[p].trim())return u("Please fill in all required fields"),!1;return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(f.email)?!0:(u("Please enter a valid email address"),!1)},y=()=>{const m=x.cardNumber.replace(/\s/g,"");if(m.length<13||m.length>19)return u("Please enter a valid card number"),!1;if(!x.expiryMonth||!x.expiryYear)return u("Please enter the card expiry date"),!1;const _=parseInt(x.expiryMonth),p=parseInt(x.expiryYear),k=new Date().getFullYear();return _<1||_>12?(u("Please enter a valid expiry month (01-12)"),!1):p<k||p>k+20?(u("Please enter a valid expiry year"),!1):x.cvv.length<3?(u("Please enter a valid CVV"),!1):x.cardholderName.trim()?!0:(u("Please enter the cardholder name"),!1)},C=async()=>{var m,_;if(y())try{l(!0),d("processing"),u(null);const{data:p,error:k}=await V.functions.invoke("create-square-payment-intent",{body:{amount:Math.round(r*100),currency:"USD",customer:f,payment:{...x,cardNumber:x.cardNumber.replace(/\s/g,""),expiryMonth:x.expiryMonth.padStart(2,"0"),expiryYear:x.expiryYear},items:s.map($=>({id:$.product_id,name:$.product_name,variant:$.variant_name,quantity:$.quantity,price:$.price})),sessionId:a}});if(k)throw new Error(k.message||"Payment failed");if(!((m=p==null?void 0:p.data)!=null&&m.success))throw new Error(((_=p==null?void 0:p.data)==null?void 0:_.error)||"Payment processing failed");await i(),n(p.data.orderId)}catch(p){console.error("Payment processing error:",p),u(p.message||"Payment failed. Please try again."),d("payment")}finally{l(!1)}};return c==="processing"?t.jsx("div",{className:"max-w-md mx-auto",children:t.jsx(T,{children:t.jsxs(E,{className:"p-8 text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Processing Payment"}),t.jsx("p",{className:"text-gray-600",children:"Please wait while we process your payment securely..."})]})})}):t.jsxs("div",{className:"max-w-4xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-8",children:[t.jsx("div",{className:"lg:col-span-1",children:t.jsxs(T,{children:[t.jsx(L,{children:t.jsxs(U,{className:"flex items-center gap-2",children:[t.jsx(He,{className:"h-5 w-5"}),"Order Summary"]})}),t.jsxs(E,{className:"space-y-4",children:[s.map(m=>{const _=`${m.product_id}-${m.variant_id||"default"}`;return t.jsxs("div",{className:"flex justify-between items-start text-sm",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"font-medium",children:m.product_name}),m.variant_name&&t.jsx("p",{className:"text-gray-600",children:m.variant_name}),t.jsxs("p",{className:"text-gray-600",children:["Qty: ",m.quantity]})]}),t.jsx("p",{className:"font-medium",children:M(m.price*m.quantity)})]},_)}),t.jsx("hr",{}),t.jsxs("div",{className:"flex justify-between font-semibold text-lg",children:[t.jsx("span",{children:"Total:"}),t.jsx("span",{className:"text-blue-600",children:M(r)})]})]})]})}),t.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[h&&t.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-red-700",children:h}),c==="customer"&&t.jsxs(T,{children:[t.jsx(L,{children:t.jsxs(U,{className:"flex items-center gap-2",children:[t.jsx(Ns,{className:"h-5 w-5"}),"Customer Information"]})}),t.jsxs(E,{className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"First Name *"}),t.jsx("input",{type:"text",value:f.firstName,onChange:m=>N("firstName",m.target.value),className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"John",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"Last Name *"}),t.jsx("input",{type:"text",value:f.lastName,onChange:m=>N("lastName",m.target.value),className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Doe",required:!0})]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium mb-2 flex items-center gap-2",children:[t.jsx(Ce,{className:"h-4 w-4"}),"Email Address *"]}),t.jsx("input",{type:"email",value:f.email,onChange:m=>N("email",m.target.value),className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"john@example.com",required:!0})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium mb-2 flex items-center gap-2",children:[t.jsx(ks,{className:"h-4 w-4"}),"Phone Number *"]}),t.jsx("input",{type:"tel",value:f.phone,onChange:m=>N("phone",m.target.value),className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"(555) 123-4567",required:!0})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium mb-2 flex items-center gap-2",children:[t.jsx($t,{className:"h-4 w-4"}),"Address *"]}),t.jsx("input",{type:"text",value:f.address,onChange:m=>N("address",m.target.value),className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"123 Main St",required:!0})]}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"City *"}),t.jsx("input",{type:"text",value:f.city,onChange:m=>N("city",m.target.value),className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"New York",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"State *"}),t.jsx("input",{type:"text",value:f.state,onChange:m=>N("state",m.target.value),className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"NY",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"ZIP Code *"}),t.jsx("input",{type:"text",value:f.zipCode,onChange:m=>N("zipCode",m.target.value),className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"10001",required:!0})]})]}),t.jsxs("div",{className:"flex gap-4 pt-4",children:[t.jsx(S,{variant:"outline",onClick:e,children:"Back to Cart"}),t.jsx(S,{onClick:()=>{b()&&d("payment")},className:"flex-1",children:"Continue to Payment"})]})]})]}),c==="payment"&&t.jsxs(T,{children:[t.jsx(L,{children:t.jsxs(U,{className:"flex items-center gap-2",children:[t.jsx(Ft,{className:"h-5 w-5"}),"Payment Information"]})}),t.jsxs(E,{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"Cardholder Name *"}),t.jsx("input",{type:"text",value:x.cardholderName,onChange:m=>O("cardholderName",m.target.value),className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"John Doe",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"Card Number *"}),t.jsx("input",{type:"text",value:x.cardNumber,onChange:m=>O("cardNumber",m.target.value),className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"1234 5678 9012 3456",required:!0})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"Month *"}),t.jsx("input",{type:"text",value:x.expiryMonth,onChange:m=>O("expiryMonth",m.target.value),className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"12",maxLength:2,required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"Year *"}),t.jsx("input",{type:"text",value:x.expiryYear,onChange:m=>O("expiryYear",m.target.value),className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"2025",maxLength:4,required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"CVV *"}),t.jsx("input",{type:"text",value:x.cvv,onChange:m=>O("cvv",m.target.value),className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"123",maxLength:4,required:!0})]})]}),t.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 text-sm text-blue-700",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Ft,{className:"h-4 w-4"}),t.jsx("span",{className:"font-medium",children:"Secure Payment"})]}),t.jsx("p",{className:"mt-1",children:"Your payment information is encrypted and secure."})]}),t.jsxs("div",{className:"flex gap-4 pt-4",children:[t.jsx(S,{variant:"outline",onClick:()=>d("customer"),children:"Back"}),t.jsx(S,{onClick:C,disabled:o,className:"flex-1 bg-gradient-to-r from-emerald-600 to-green-700 hover:from-emerald-700 hover:to-green-800",children:o?"Processing...":`Pay ${M(r)}`})]})]})]})]})]})}function _i({orderId:n,onContinueShopping:e}){return t.jsx("div",{className:"max-w-2xl mx-auto",children:t.jsx(T,{className:"text-center",children:t.jsxs(E,{className:"p-12",children:[t.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6",children:t.jsx(yt,{className:"w-8 h-8 text-green-600"})}),t.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Order Confirmed!"}),t.jsx("p",{className:"text-gray-600 mb-6",children:"Thank you for your purchase. Your order has been successfully processed."}),t.jsx("div",{className:"bg-gray-50 rounded-lg p-6 mb-8",children:t.jsxs("div",{className:"flex items-center justify-center gap-3 text-lg",children:[t.jsx(Ss,{className:"w-6 h-6 text-blue-600"}),t.jsx("span",{className:"font-medium",children:"Order Number:"}),t.jsxs("span",{className:"font-mono text-blue-600 bg-white px-3 py-1 rounded border",children:["#",n.slice(-8).toUpperCase()]})]})}),t.jsxs("div",{className:"space-y-4 mb-8",children:[t.jsxs("div",{className:"flex items-center justify-center gap-3 text-gray-700",children:[t.jsx(Ce,{className:"w-5 h-5"}),t.jsx("span",{children:"A confirmation email has been sent to your email address."})]}),t.jsxs("div",{className:"flex items-center justify-center gap-3 text-gray-700",children:[t.jsx(wr,{className:"w-5 h-5"}),t.jsx("span",{children:"You can track your order status in your account dashboard."})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx(S,{onClick:e,className:"w-full bg-gradient-to-r from-blue-600 to-indigo-700 hover:from-blue-700 hover:to-indigo-800",children:"Continue Shopping"}),t.jsx(S,{variant:"outline",onClick:()=>window.location.href="/admin/orders",className:"w-full",children:"View Order Details"})]}),t.jsx("p",{className:"text-sm text-gray-500 mt-8",children:"Need help? Contact our support team at support@budlife.com"})]})})})}function Ni({isOpen:n,onClose:e}){const[s,r]=j.useState("checkout"),[a,i]=j.useState(""),o=c=>{i(c),r("success")},l=()=>{r("checkout"),i(""),e()};return n?t.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[t.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm",onClick:l}),t.jsx("div",{className:"relative min-h-screen flex items-start justify-center p-4 pt-8",children:t.jsxs("div",{className:"relative bg-white rounded-lg shadow-2xl w-full max-w-6xl",children:[t.jsxs("div",{className:"sticky top-0 flex items-center justify-between p-6 border-b bg-white rounded-t-lg z-10",children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:s==="checkout"?"Checkout":"Order Complete"}),t.jsx("button",{onClick:l,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:t.jsx(Ot,{className:"h-6 w-6 text-gray-500"})})]}),t.jsxs("div",{className:"p-6",children:[s==="checkout"&&t.jsx(ji,{onSuccess:o,onBack:l}),s==="success"&&t.jsx(_i,{orderId:a,onContinueShopping:l})]})]})})]}):null}const ki=[{name:"Dashboard",href:"/dashboard",icon:jr,color:"from-blue-600 to-blue-700"},{name:"Products",href:"/products",icon:X,color:"from-emerald-600 to-emerald-700"},{name:"COAs",href:"/coas",icon:Cs,color:"from-purple-600 to-purple-700"},{name:"Orders",href:"/orders",icon:ae,color:"from-orange-600 to-orange-700"},{name:"Customers",href:"/customers",icon:Pe,color:"from-blue-500 to-blue-600"},{name:"Content/Blog",href:"/content",icon:Es,color:"from-indigo-600 to-indigo-700"},{name:"Media",href:"/media",icon:Ts,color:"from-teal-600 to-teal-700"},{name:"Marketing",href:"/marketing",icon:As,color:"from-amber-600 to-amber-700"},{name:"Social Hub",href:"/social",icon:Ps,color:"from-violet-600 to-violet-700"},{name:"Analytics",href:"/analytics",icon:Os,color:"from-green-600 to-green-700"},{name:"Settings",href:"/settings",icon:$s,color:"from-gray-600 to-gray-700"}];function Si({children:n}){const[e,s]=j.useState(!1),[r,a]=j.useState(!1),[i,o]=j.useState(!1),[l,c]=j.useState(!1),d=pr();js();const{totalItems:h}=Le(),u=()=>{o(!1),c(!0)};return t.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-blue-50",children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-50/10 via-transparent to-gray-50/10 pointer-events-none"}),t.jsx("div",{className:"absolute inset-0 pointer-events-none opacity-20",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23000000' fill-opacity='0.02'%3E%3Ccircle cx='30' cy='30' r='2'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),e&&t.jsx("div",{className:"fixed inset-0 z-40 bg-black/50 backdrop-blur-sm lg:hidden",onClick:()=>s(!1)}),t.jsx("div",{className:J("fixed inset-y-0 z-50 flex w-72 flex-col transition-transform duration-300 ease-in-out lg:translate-x-0",e?"translate-x-0":"-translate-x-full lg:translate-x-0"),children:t.jsxs("div",{className:"flex grow flex-col gap-y-5 overflow-y-auto bg-white backdrop-blur-xl border-r border-gray-200 shadow-lg",children:[t.jsx("div",{className:"flex h-16 shrink-0 items-center px-6 bg-gradient-to-r from-blue-600 to-indigo-700",children:t.jsx("h1",{className:"text-xl font-semibold text-white tracking-tight",children:"Bud Life Admin Module"})}),t.jsx("nav",{className:"flex flex-1 flex-col px-4",children:t.jsxs("ul",{role:"list",className:"flex flex-1 flex-col gap-y-2",children:[t.jsxs("li",{className:"pt-2",children:[t.jsx("div",{className:"text-xs font-semibold text-gray-400 uppercase tracking-wide px-3 pb-2",children:"E-commerce"}),t.jsxs(Bt,{to:"/store",target:"_blank",className:"group flex gap-x-3 rounded-lg p-3 text-sm leading-6 font-medium transition-all duration-200 relative overflow-hidden bg-gradient-to-r from-green-600 to-emerald-700 text-white shadow-sm hover:from-green-700 hover:to-emerald-800",children:[t.jsx(_r,{className:"h-5 w-5 shrink-0 text-white"}),t.jsx("span",{className:"text-white",children:"View Storefront"}),t.jsx(D,{variant:"secondary",className:"ml-auto bg-white/20 text-white border-white/30 text-xs",children:"New"})]})]}),t.jsx("li",{children:t.jsx("div",{className:"text-xs font-semibold text-gray-400 uppercase tracking-wide px-3 pb-2 pt-6",children:"Administration"})}),ki.map(f=>{const g=f.icon,x=d.pathname===f.href||d.pathname.startsWith(f.href+"/");return t.jsx("li",{children:t.jsxs(Bt,{to:f.href,className:J("group flex gap-x-3 rounded-lg p-3 text-sm leading-6 font-medium transition-all duration-200 relative overflow-hidden",x?"bg-gradient-to-r text-white shadow-sm":"text-gray-700 hover:text-white hover:bg-gradient-to-r hover:shadow-sm",`${f.color}`),children:[t.jsx(g,{className:J("h-5 w-5 shrink-0",x?"text-white":"text-gray-600 group-hover:text-white")}),t.jsx("span",{className:J(x?"text-white":"text-gray-700 group-hover:text-white"),children:f.name}),x&&t.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 w-1 h-1 bg-white rounded-full"})]})},f.name)})]})})]})}),t.jsxs("div",{className:"lg:pl-72",children:[t.jsxs("div",{className:"sticky top-0 z-40 flex h-16 shrink-0 items-center gap-x-4 border-b border-gray-200 bg-white px-4 shadow-sm sm:gap-x-6 sm:px-6 lg:px-8",children:[t.jsxs(S,{variant:"ghost",size:"icon",className:"-m-2.5 p-2.5 text-gray-700 lg:hidden",onClick:()=>s(!0),children:[t.jsx("span",{className:"sr-only",children:"Open sidebar"}),t.jsx(Nr,{className:"h-6 w-6"})]}),t.jsxs("div",{className:"flex flex-1 gap-x-4 self-stretch lg:gap-x-6",children:[t.jsxs("form",{className:"relative flex flex-1",action:"#",method:"GET",children:[t.jsx("label",{htmlFor:"search-field",className:"sr-only",children:"Search"}),t.jsx(Qe,{className:"pointer-events-none absolute inset-y-0 left-0 h-full w-5 text-gray-400 pl-3"}),t.jsx("input",{id:"search-field",className:"block h-full w-full border-0 py-0 pl-10 pr-0 text-gray-900 placeholder:text-gray-400 focus:ring-0 bg-transparent sm:text-sm",placeholder:"Search products, orders, customers...",type:"search",name:"search"})]}),t.jsxs("div",{className:"flex items-center gap-x-4 lg:gap-x-6",children:[t.jsxs(S,{variant:"ghost",size:"icon",className:"relative",onClick:()=>o(!0),children:[t.jsx(Ss,{className:"h-5 w-5"}),h>0&&t.jsx(D,{variant:"destructive",className:"absolute -top-1 -right-1 h-5 w-5 rounded-full p-0 text-xs flex items-center justify-center",children:h>99?"99+":h})]}),t.jsxs(S,{variant:"ghost",size:"icon",className:"relative",children:[t.jsx(kr,{className:"h-5 w-5"}),t.jsx(D,{variant:"destructive",className:"absolute -top-1 -right-1 h-5 w-5 rounded-full p-0 text-xs flex items-center justify-center",children:"3"})]}),t.jsxs("div",{className:"relative",children:[t.jsxs(S,{variant:"ghost",className:"flex items-center gap-x-1 text-sm font-semibold leading-6 text-gray-900",onClick:()=>a(!r),children:[t.jsx("div",{className:"h-8 w-8 rounded-full bg-gradient-to-br from-blue-600 to-indigo-700 flex items-center justify-center",children:t.jsx(Ns,{className:"h-4 w-4 text-white"})}),t.jsx("span",{className:"sr-only sm:not-sr-only",children:"Admin User"}),t.jsx(Sr,{className:"h-4 w-4"})]}),r&&t.jsx("div",{className:"absolute right-0 z-10 mt-2.5 w-32 origin-top-right rounded-lg bg-white shadow-lg ring-1 ring-gray-900/5 transition-all",children:t.jsx("div",{className:"p-1",children:t.jsxs("button",{className:"flex w-full items-center gap-x-2 rounded-md px-3 py-2 text-sm text-gray-700 hover:bg-gray-50",children:[t.jsx(Cr,{className:"h-4 w-4"}),"Sign out"]})})})]})]})]})]}),t.jsx("main",{className:"py-8 px-4 sm:px-6 lg:px-8 relative",children:n})]}),t.jsx(wi,{isOpen:i,onClose:()=>o(!1),onCheckout:u}),t.jsx(Ni,{isOpen:l,onClose:()=>c(!1)})]})}const Ci={sm:"h-4 w-4",md:"h-6 w-6",lg:"h-8 w-8",xl:"h-12 w-12"};function mr({size:n="md",text:e,className:s}){return t.jsx("div",{className:`flex items-center justify-center ${s||""}`,children:t.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[t.jsx(Er,{className:`animate-spin text-blue-600 ${Ci[n]}`}),e&&t.jsx("p",{className:"text-sm text-gray-600",children:e})]})})}class Ei{async getDashboardData(e="7days"){try{return{totalRevenue:12500,totalOrders:48,completedOrders:42,newCustomers:15,activeProducts:28,lowStockProducts:3,period:e}}catch(s){throw console.error("Error fetching dashboard data:",s),s}}async getProducts(e){try{const{data:s,error:r}=await V.from("products").select(`
          *,
          product_variants(*)
        `).order("created_at",{ascending:!1});if(r)throw r;return s||[]}catch(s){throw console.error("Error fetching products:",s),s}}async createProduct(e){try{const{data:s,error:r}=await V.from("products").insert(e).select().single();if(r)throw r;return s}catch(s){throw console.error("Error creating product:",s),s}}async updateProduct(e,s){try{const{data:r,error:a}=await V.from("products").update(s).eq("id",e).select().single();if(a)throw a;return r}catch(r){throw console.error("Error updating product:",r),r}}async deleteProduct(e){try{const{error:s}=await V.from("products").delete().eq("id",e);if(s)throw s;return!0}catch(s){throw console.error("Error deleting product:",s),s}}}const Ti=new Ei,re={primary:["#2563EB","#3B82F6","#60A5FA","#93C5FD"],success:["#059669","#10B981","#34D399","#6EE7B7"],warning:["#D97706","#F59E0B","#FBBF24","#FCD34D"],danger:["#DC2626","#EF4444","#F87171","#FCA5A5"],info:["#0891B2","#06B6D4","#22D3EE","#67E8F9"]},Ai=[{date:"2025-01-15",revenue:2400,orders:12,customers:8},{date:"2025-01-16",revenue:1800,orders:9,customers:6},{date:"2025-01-17",revenue:3200,orders:16,customers:12},{date:"2025-01-18",revenue:2800,orders:14,customers:10},{date:"2025-01-19",revenue:4200,orders:21,customers:15},{date:"2025-01-20",revenue:3600,orders:18,customers:13},{date:"2025-01-21",revenue:5100,orders:24,customers:18}],xt=[{name:"Completed",value:45,color:re.success[0]},{name:"Processing",value:30,color:re.info[0]},{name:"Pending",value:20,color:re.warning[0]},{name:"Cancelled",value:5,color:re.danger[0]}],ws=[{name:"Flower",sales:4500,color:re.primary[0]},{name:"Edibles",sales:3200,color:re.success[0]},{name:"Concentrates",sales:2800,color:re.warning[0]},{name:"Topicals",sales:1500,color:re.info[0]},{name:"Accessories",sales:800,color:re.danger[0]}];function Ve({title:n,value:e,change:s,icon:r,gradient:a,description:i}){const o=s&&s>0,l=s&&s<0;return t.jsxs(T,{className:"relative overflow-hidden hover:shadow-md transition-all duration-300",children:[t.jsxs(L,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(U,{className:"text-sm font-medium text-gray-600",children:n}),t.jsx("div",{className:`p-2 rounded-lg bg-gradient-to-br ${a}`,children:t.jsx(r,{className:"h-4 w-4 text-white"})})]}),t.jsx(E,{children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-2xl font-semibold text-gray-900",children:e}),i&&t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:i})]}),s!==void 0&&t.jsxs("div",{className:`flex items-center text-sm font-medium ${o?"text-emerald-600":l?"text-red-600":"text-gray-600"}`,children:[o?t.jsx(Ar,{className:"h-4 w-4 mr-1"}):l?t.jsx(Pr,{className:"h-4 w-4 mr-1"}):null,Math.abs(s),"%"]})]})})]})}function Pi(){const[n,e]=j.useState(null),[s,r]=j.useState(!0),[a,i]=j.useState(""),[o,l]=j.useState("7days");j.useEffect(()=>{c()},[o]);const c=async()=>{try{r(!0),i("");const d=await Ti.getDashboardData(o);e(d)}catch(d){console.error("Dashboard data error:",d),i(d.message||"Failed to load dashboard data")}finally{r(!1)}};return s?t.jsx("div",{className:"flex items-center justify-center h-96",children:t.jsx(mr,{size:"xl",text:"Loading dashboard..."})}):a?t.jsx("div",{className:"text-center py-12",children:t.jsxs("div",{className:"p-8 bg-red-50 rounded-xl border border-red-200 inline-block",children:[t.jsx(Rs,{className:"h-12 w-12 text-red-600 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-semibold text-red-900 mb-2",children:"Error Loading Dashboard"}),t.jsx("p",{className:"text-red-700 mb-4",children:a}),t.jsx(S,{onClick:c,variant:"destructive",children:"Try Again"})]})}):t.jsxs("div",{className:"space-y-8",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-semibold text-gray-900",children:"Dashboard Overview"}),t.jsx("p",{className:"text-gray-600 mt-1",children:"Welcome back! Here's what's happening with your business."})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("select",{value:o,onChange:d=>l(d.target.value),className:"px-4 py-2 border border-gray-200 rounded-lg bg-white shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[t.jsx("option",{value:"24h",children:"Last 24 Hours"}),t.jsx("option",{value:"7days",children:"Last 7 Days"}),t.jsx("option",{value:"30days",children:"Last 30 Days"}),t.jsx("option",{value:"90days",children:"Last 90 Days"})]}),t.jsxs(S,{variant:"info",className:"shadow-lg",children:[t.jsx(Is,{className:"h-4 w-4 mr-2"}),"Export Report"]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6",children:[t.jsx(Ve,{title:"Total Revenue",value:M((n==null?void 0:n.totalRevenue)||0),change:12.5,icon:Ls,gradient:"from-emerald-600 to-emerald-700",description:"vs last period"}),t.jsx(Ve,{title:"Total Orders",value:(n==null?void 0:n.totalOrders)||0,change:8.2,icon:ae,gradient:"from-blue-600 to-blue-700",description:`${(n==null?void 0:n.completedOrders)||0} completed`}),t.jsx(Ve,{title:"New Customers",value:(n==null?void 0:n.newCustomers)||0,change:15.3,icon:Pe,gradient:"from-purple-600 to-purple-700",description:"this period"}),t.jsx(Ve,{title:"Active Products",value:(n==null?void 0:n.activeProducts)||0,change:-2.1,icon:X,gradient:"from-orange-600 to-orange-700",description:`${(n==null?void 0:n.lowStockProducts)||0} low stock`})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs(T,{className:"hover:shadow-md transition-all duration-300",children:[t.jsx(L,{children:t.jsxs(U,{className:"flex items-center gap-2",children:[t.jsx("div",{className:"p-2 bg-gradient-to-br from-blue-600 to-blue-700 rounded-lg",children:t.jsx(Ds,{className:"h-4 w-4 text-white"})}),"Revenue & Orders Trend"]})}),t.jsx(E,{children:t.jsx(lt,{width:"100%",height:300,children:t.jsxs(Ur,{data:Ai,children:[t.jsx("defs",{children:t.jsxs("linearGradient",{id:"revenueGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[t.jsx("stop",{offset:"5%",stopColor:"#3B82F6",stopOpacity:.3}),t.jsx("stop",{offset:"95%",stopColor:"#3B82F6",stopOpacity:0})]})}),t.jsx(Gt,{strokeDasharray:"3 3",stroke:"#E5E7EB"}),t.jsx(Yt,{dataKey:"date",stroke:"#6B7280",fontSize:12}),t.jsx(Qt,{stroke:"#6B7280",fontSize:12}),t.jsx(ct,{contentStyle:{backgroundColor:"white",border:"none",borderRadius:"12px",boxShadow:"0 10px 25px -5px rgba(0, 0, 0, 0.1)"}}),t.jsx(Br,{type:"monotone",dataKey:"revenue",stroke:"#3B82F6",strokeWidth:3,fill:"url(#revenueGradient)"})]})})})]}),t.jsxs(T,{className:"hover:shadow-md transition-all duration-300",children:[t.jsx(L,{children:t.jsxs(U,{className:"flex items-center gap-2",children:[t.jsx("div",{className:"p-2 bg-gradient-to-br from-purple-600 to-purple-700 rounded-lg",children:t.jsx(Tr,{className:"h-4 w-4 text-white"})}),"Order Status Distribution"]})}),t.jsxs(E,{children:[t.jsx(lt,{width:"100%",height:300,children:t.jsxs(Mr,{children:[t.jsx(qr,{data:xt,cx:"50%",cy:"50%",outerRadius:100,innerRadius:60,paddingAngle:5,dataKey:"value",children:xt.map((d,h)=>t.jsx(Xt,{fill:d.color},`cell-${h}`))}),t.jsx(ct,{})]})}),t.jsx("div",{className:"flex flex-wrap gap-4 mt-4",children:xt.map((d,h)=>t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:d.color}}),t.jsxs("span",{className:"text-sm text-gray-600",children:[d.name," (",d.value,"%)"]})]},h))})]})]})]}),t.jsxs(T,{className:"hover:shadow-xl transition-all duration-300",children:[t.jsx(L,{children:t.jsxs(U,{className:"flex items-center gap-2",children:[t.jsx("div",{className:"p-2 bg-gradient-to-br from-green-500 to-emerald-600 rounded-lg",children:t.jsx(Zt,{className:"h-4 w-4 text-white"})}),"Product Category Performance"]})}),t.jsx(E,{children:t.jsx(lt,{width:"100%",height:300,children:t.jsxs(Zt,{data:ws,margin:{top:20,right:30,left:20,bottom:5},children:[t.jsx(Gt,{strokeDasharray:"3 3",stroke:"#E5E7EB"}),t.jsx(Yt,{dataKey:"name",stroke:"#6B7280",fontSize:12}),t.jsx(Qt,{stroke:"#6B7280",fontSize:12}),t.jsx(ct,{contentStyle:{backgroundColor:"white",border:"none",borderRadius:"12px",boxShadow:"0 10px 25px -5px rgba(0, 0, 0, 0.1)"},formatter:d=>[M(Number(d)),"Sales"]}),t.jsx(Fr,{dataKey:"sales",radius:[8,8,0,0],fill:"#3B82F6",children:ws.map((d,h)=>t.jsx(Xt,{fill:d.color},`cell-${h}`))})]})})})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[t.jsx(T,{className:"group hover:shadow-xl transition-all duration-300 cursor-pointer border-2 border-transparent hover:border-blue-200",children:t.jsxs(E,{className:"p-6 text-center",children:[t.jsx("div",{className:"p-4 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full w-16 h-16 mx-auto mb-4 group-hover:scale-110 transition-transform",children:t.jsx(X,{className:"h-8 w-8 text-white"})}),t.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Add New Product"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Quickly add new hemp products to your inventory"})]})}),t.jsx(T,{className:"group hover:shadow-xl transition-all duration-300 cursor-pointer border-2 border-transparent hover:border-green-200",children:t.jsxs(E,{className:"p-6 text-center",children:[t.jsx("div",{className:"p-4 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full w-16 h-16 mx-auto mb-4 group-hover:scale-110 transition-transform",children:t.jsx(Pe,{className:"h-8 w-8 text-white"})}),t.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"View Customers"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Manage customer relationships and orders"})]})}),t.jsx(T,{className:"group hover:shadow-xl transition-all duration-300 cursor-pointer border-2 border-transparent hover:border-purple-200",children:t.jsxs(E,{className:"p-6 text-center",children:[t.jsx("div",{className:"p-4 bg-gradient-to-br from-purple-500 to-pink-600 rounded-full w-16 h-16 mx-auto mb-4 group-hover:scale-110 transition-transform",children:t.jsx(Us,{className:"h-8 w-8 text-white"})}),t.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Analytics"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Dive deep into your business metrics"})]})})]})]})}function Oi(){const[n,e]=j.useState([]),[s,r]=j.useState(!0),[a,i]=j.useState(""),[o,l]=j.useState(""),[c,d]=j.useState("grid");j.useEffect(()=>{h()},[]);const h=async()=>{try{r(!0),i("");const{data:f,error:g}=await V.from("products").select(`
          *,
          product_variants(count)
        `).order("created_at",{ascending:!1});if(g)throw g;e(f||[])}catch(f){console.error("Failed to load products:",f),i(f.message||"Failed to load products")}finally{r(!1)}},u=n.filter(f=>o===""||f.name.toLowerCase().includes(o.toLowerCase())||f.description.toLowerCase().includes(o.toLowerCase()));return s?t.jsx("div",{className:"flex items-center justify-center h-96",children:t.jsx(mr,{size:"xl",text:"Loading products..."})}):t.jsxs("div",{className:"space-y-8",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-semibold text-gray-900",children:"Products Management"}),t.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your hemp product inventory"})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(S,{variant:"outline",size:"icon",onClick:()=>d(c==="grid"?"list":"grid"),children:c==="grid"?t.jsx(Or,{className:"h-4 w-4"}):t.jsx($r,{className:"h-4 w-4"})}),t.jsxs(S,{className:"bg-gradient-to-r from-emerald-600 to-green-700",children:[t.jsx(Je,{className:"h-4 w-4 mr-2"}),"Add Product"]})]})]}),t.jsxs("div",{className:"bg-white rounded-xl shadow-sm border p-6",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[t.jsx("div",{className:"flex-1",children:t.jsxs("div",{className:"relative",children:[t.jsx(Qe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search products...",value:o,onChange:f=>l(f.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),t.jsxs(S,{variant:"outline",children:[t.jsx(Rr,{className:"h-4 w-4 mr-2"}),"Filters"]})]}),t.jsx("div",{className:"flex items-center justify-between mt-4 pt-4 border-t",children:t.jsxs("p",{className:"text-sm text-gray-600",children:["Showing ",u.length," of ",n.length," products"]})})]}),a?t.jsx("div",{className:"text-center py-12",children:t.jsxs("div",{className:"p-8 bg-red-50 rounded-xl border border-red-200 inline-block",children:[t.jsx(X,{className:"h-12 w-12 text-red-600 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-semibold text-red-900 mb-2",children:"Error Loading Products"}),t.jsx("p",{className:"text-red-700 mb-4",children:a}),t.jsx(S,{onClick:h,variant:"destructive",children:"Try Again"})]})}):u.length===0?t.jsxs("div",{className:"text-center py-12",children:[t.jsx(X,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No products found"}),t.jsx("p",{className:"text-gray-600 mb-6",children:"Get started by adding your first product"}),t.jsxs(S,{className:"bg-gradient-to-r from-emerald-600 to-green-700",children:[t.jsx(Je,{className:"h-4 w-4 mr-2"}),"Add Your First Product"]})]}):t.jsx("div",{className:c==="grid"?"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6":"space-y-4",children:u.map(f=>t.jsx(T,{className:"group hover:shadow-xl transition-all duration-300",children:c==="grid"?t.jsxs(t.Fragment,{children:[t.jsx(L,{className:"p-0",children:t.jsxs("div",{className:"relative overflow-hidden rounded-t-lg",children:[f.image_url?t.jsx("img",{src:f.image_url,alt:f.name,className:"w-full h-48 object-cover group-hover:scale-105 transition-transform duration-300"}):t.jsx("div",{className:"w-full h-48 bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center",children:t.jsx(X,{className:"h-16 w-16 text-gray-400"})}),t.jsx("div",{className:"absolute top-3 left-3",children:f.is_featured&&t.jsxs(D,{className:"bg-amber-500 text-white border-0",children:[t.jsx(Ke,{className:"h-3 w-3 mr-1"}),"Featured"]})}),t.jsx("div",{className:"absolute top-3 right-3 opacity-0 group-hover:opacity-100 transition-opacity",children:t.jsx(S,{variant:"ghost",size:"icon",className:"bg-white/80 hover:bg-white",children:t.jsx(Ir,{className:"h-4 w-4"})})})]})}),t.jsx(E,{className:"p-4",children:t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold text-gray-900 line-clamp-2",children:f.name}),t.jsx("p",{className:"text-sm text-gray-600 line-clamp-2 mt-1",children:f.description})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-xl font-bold text-blue-600",children:M(f.price)}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(S,{variant:"ghost",size:"icon",className:"h-8 w-8",children:t.jsx(bt,{className:"h-4 w-4"})}),t.jsx(S,{variant:"ghost",size:"icon",className:"h-8 w-8",children:t.jsx(zt,{className:"h-4 w-4"})}),t.jsx(S,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-600 hover:text-red-700",children:t.jsx(Vt,{className:"h-4 w-4"})})]})]})]})})]}):t.jsx(E,{className:"p-4",children:t.jsxs("div",{className:"flex items-center space-x-4",children:[f.image_url?t.jsx("img",{src:f.image_url,alt:f.name,className:"w-16 h-16 object-cover rounded-lg"}):t.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-gray-100 to-gray-200 rounded-lg flex items-center justify-center",children:t.jsx(X,{className:"h-8 w-8 text-gray-400"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("h3",{className:"font-semibold text-gray-900 truncate",children:f.name}),f.is_featured&&t.jsx(D,{className:"bg-amber-500 text-white border-0 text-xs",children:"Featured"})]}),t.jsx("p",{className:"text-sm text-gray-600 line-clamp-1",children:f.description}),t.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[t.jsx("span",{className:"text-lg font-bold text-blue-600",children:M(f.price)}),t.jsxs("span",{className:"text-sm text-gray-500",children:["Category: ",f.category]})]})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(S,{variant:"ghost",size:"icon",className:"h-8 w-8",children:t.jsx(bt,{className:"h-4 w-4"})}),t.jsx(S,{variant:"ghost",size:"icon",className:"h-8 w-8",children:t.jsx(zt,{className:"h-4 w-4"})}),t.jsx(S,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-600 hover:text-red-700",children:t.jsx(Vt,{className:"h-4 w-4"})})]})]})})},f.id))})]})}function $i(){const[n,e]=j.useState([]),[s,r]=j.useState([]),[a,i]=j.useState(!0),[o,l]=j.useState(""),[c,d]=j.useState("orders"),[h,u]=j.useState("all"),[f,g]=j.useState(""),[x,w]=j.useState({totalOrders:0,totalRevenue:0,pendingOrders:0,completedOrders:0,emailsSent:0,emailOpenRate:0});j.useEffect(()=>{v(),N()},[]);const v=async()=>{try{i(!0),l("");const{data:m,error:_}=await V.from("orders").select(`
          *,
          order_items(*)
        `).order("created_at",{ascending:!1});if(_)throw _;const p=(m||[]).map(z=>({...z,items:z.order_items||[]}));e(p);const k=p.length,$=p.reduce((z,De)=>z+(De.total||0),0),R=p.filter(z=>z.status==="pending").length,B=p.filter(z=>z.status==="completed").length;w(z=>({...z,totalOrders:k,totalRevenue:$,pendingOrders:R,completedOrders:B}))}catch(m){console.error("Failed to load orders:",m),l(m.message||"Failed to load orders")}finally{i(!1)}},N=async()=>{try{const{data:m,error:_}=await V.from("email_logs").select("*").order("sent_at",{ascending:!1}).limit(100);if(_){console.error("Failed to load email logs:",_);return}const p=m||[];r(p);const k=p.length,$=p.filter(B=>B.opened_at).length,R=k>0?$/k*100:0;w(B=>({...B,emailsSent:k,emailOpenRate:R}))}catch(m){console.error("Failed to load email logs:",m)}},O=m=>{const _={pending:{color:"bg-yellow-100 text-yellow-800",label:"Pending"},processing:{color:"bg-blue-100 text-blue-800",label:"Processing"},completed:{color:"bg-green-100 text-green-800",label:"Completed"},cancelled:{color:"bg-red-100 text-red-800",label:"Cancelled"},refunded:{color:"bg-gray-100 text-gray-800",label:"Refunded"}},p=_[m]||_.pending;return t.jsx(D,{className:`${p.color} border-0`,children:p.label})},b=m=>{const p={order_confirmation:{color:"bg-green-100 text-green-800",label:"Order Confirmation"},abandoned_cart:{color:"bg-orange-100 text-orange-800",label:"Abandoned Cart"},reorder_reminder:{color:"bg-purple-100 text-purple-800",label:"Re-order Reminder"},shipping_update:{color:"bg-blue-100 text-blue-800",label:"Shipping Update"}}[m]||{color:"bg-gray-100 text-gray-800",label:m};return t.jsx(D,{className:`${p.color} border-0`,children:p.label})},y=n.filter(m=>{const _=h==="all"||m.status===h,p=f===""||m.order_number.toLowerCase().includes(f.toLowerCase())||m.email.toLowerCase().includes(f.toLowerCase());return _&&p}),C=s.filter(m=>f===""||m.recipient_email.toLowerCase().includes(f.toLowerCase())||m.subject.toLowerCase().includes(f.toLowerCase()));return a?t.jsx("div",{className:"space-y-8",children:t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600",children:"Loading orders and analytics..."})]})})}):o&&n.length===0?t.jsx("div",{className:"space-y-8",children:t.jsx("div",{className:"text-center py-12",children:t.jsxs("div",{className:"p-8 bg-red-50 rounded-xl border border-red-200 inline-block",children:[t.jsx(ee,{className:"h-12 w-12 text-red-600 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-semibold text-red-900 mb-2",children:"Error Loading Orders"}),t.jsx("p",{className:"text-red-700 mb-4",children:o}),t.jsxs(S,{onClick:v,variant:"destructive",children:[t.jsx(it,{className:"h-4 w-4 mr-2"}),"Try Again"]})]})})}):t.jsxs("div",{className:"space-y-8",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-semibold text-gray-900",children:"Orders & Email Management"}),t.jsx("p",{className:"text-gray-600 mt-1",children:"Track orders, manage fulfillment, and monitor email campaigns"})]}),t.jsx("div",{className:"flex items-center gap-3",children:t.jsxs(S,{onClick:v,variant:"outline",size:"sm",children:[t.jsx(it,{className:"h-4 w-4 mr-2"}),"Refresh"]})})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 xl:grid-cols-6 gap-4",children:[t.jsxs(T,{children:[t.jsxs(L,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(U,{className:"text-sm font-medium text-gray-600",children:"Total Orders"}),t.jsx(ae,{className:"h-4 w-4 text-blue-600"})]}),t.jsxs(E,{children:[t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:x.totalOrders}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"All time orders"})]})]}),t.jsxs(T,{children:[t.jsxs(L,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(U,{className:"text-sm font-medium text-gray-600",children:"Revenue"}),t.jsx(Ls,{className:"h-4 w-4 text-green-600"})]}),t.jsxs(E,{children:[t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:M(x.totalRevenue)}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Total sales"})]})]}),t.jsxs(T,{children:[t.jsxs(L,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(U,{className:"text-sm font-medium text-gray-600",children:"Pending"}),t.jsx(Wt,{className:"h-4 w-4 text-orange-600"})]}),t.jsxs(E,{children:[t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:x.pendingOrders}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Awaiting processing"})]})]}),t.jsxs(T,{children:[t.jsxs(L,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(U,{className:"text-sm font-medium text-gray-600",children:"Completed"}),t.jsx(Ue,{className:"h-4 w-4 text-green-600"})]}),t.jsxs(E,{children:[t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:x.completedOrders}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Orders fulfilled"})]})]}),t.jsxs(T,{children:[t.jsxs(L,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(U,{className:"text-sm font-medium text-gray-600",children:"Emails Sent"}),t.jsx(Ce,{className:"h-4 w-4 text-purple-600"})]}),t.jsxs(E,{children:[t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:x.emailsSent}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"All automated emails"})]})]}),t.jsxs(T,{children:[t.jsxs(L,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(U,{className:"text-sm font-medium text-gray-600",children:"Email Open Rate"}),t.jsx(Ds,{className:"h-4 w-4 text-indigo-600"})]}),t.jsxs(E,{children:[t.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:[x.emailOpenRate.toFixed(1),"%"]}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Email engagement"})]})]})]}),t.jsx("div",{className:"border-b border-gray-200",children:t.jsxs("nav",{className:"flex space-x-8",children:[t.jsxs("button",{onClick:()=>d("orders"),className:`py-2 px-1 border-b-2 font-medium text-sm ${c==="orders"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[t.jsx(ae,{className:"h-4 w-4 inline mr-2"}),"Orders (",x.totalOrders,")"]}),t.jsxs("button",{onClick:()=>d("emails"),className:`py-2 px-1 border-b-2 font-medium text-sm ${c==="emails"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[t.jsx(Ce,{className:"h-4 w-4 inline mr-2"}),"Email Campaigns (",x.emailsSent,")"]})]})}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[t.jsx("div",{className:"flex-1",children:t.jsxs("div",{className:"relative",children:[t.jsx(Qe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:c==="orders"?"Search orders...":"Search emails...",value:f,onChange:m=>g(m.target.value),className:"pl-10 pr-4 py-2 w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),c==="orders"&&t.jsx("div",{className:"sm:w-48",children:t.jsxs("select",{value:h,onChange:m=>u(m.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[t.jsx("option",{value:"all",children:"All Status"}),t.jsx("option",{value:"pending",children:"Pending"}),t.jsx("option",{value:"processing",children:"Processing"}),t.jsx("option",{value:"completed",children:"Completed"}),t.jsx("option",{value:"cancelled",children:"Cancelled"})]})})]}),c==="orders"&&t.jsx("div",{className:"space-y-6",children:y.length===0?t.jsx(T,{className:"text-center py-12",children:t.jsx(E,{children:t.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[t.jsx("div",{className:"p-4 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full",children:t.jsx(ae,{className:"h-12 w-12 text-white"})}),t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"No Orders Found"}),t.jsx("p",{className:"text-gray-600 max-w-md",children:f||h!=="all"?"No orders match your current filters. Try adjusting your search criteria.":"When customers complete purchases through the storefront, their orders will appear here automatically."}),t.jsxs("div",{className:"flex items-center gap-2 text-sm text-blue-600 bg-blue-50 px-4 py-2 rounded-lg",children:[t.jsx(Ue,{className:"h-4 w-4"}),t.jsx("span",{children:"E-commerce system is active and processing orders"})]})]})})}):t.jsx("div",{className:"space-y-4",children:y.map(m=>{var _,p,k,$,R;return t.jsx(T,{className:"hover:shadow-md transition-shadow",children:t.jsx(E,{className:"p-6",children:t.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[t.jsxs("div",{className:"flex-1 space-y-3",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Order #",m.order_number]}),O(m.status),m.payment_status==="completed"&&t.jsxs(D,{className:"bg-green-100 text-green-800 border-0",children:[t.jsx(Ue,{className:"h-3 w-3 mr-1"}),"Paid"]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-sm",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-500",children:"Customer:"}),t.jsx("p",{className:"font-medium text-gray-900",children:m.email}),m.phone&&t.jsx("p",{className:"text-gray-600",children:m.phone})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-500",children:"Order Date:"}),t.jsx("p",{className:"font-medium text-gray-900",children:new Date(m.created_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}),t.jsx("p",{className:"text-gray-600",children:new Date(m.created_at).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-500",children:"Items:"}),t.jsxs("p",{className:"font-medium text-gray-900",children:[((_=m.items)==null?void 0:_.length)||0," item",(((p=m.items)==null?void 0:p.length)||0)!==1?"s":""]}),(k=m.items)==null?void 0:k.slice(0,2).map((B,z)=>t.jsxs("p",{className:"text-gray-600 text-xs truncate",children:[B.quantity,"× ",B.product_name]},z)),((($=m.items)==null?void 0:$.length)||0)>2&&t.jsxs("p",{className:"text-gray-600 text-xs",children:["+",(((R=m.items)==null?void 0:R.length)||0)-2," more"]})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-500",children:"Total:"}),t.jsx("p",{className:"text-xl font-bold text-gray-900",children:M(m.total)}),m.square_payment_id&&t.jsxs("p",{className:"text-xs text-gray-500",children:["Square: ",m.square_payment_id.slice(-8)]})]})]}),m.shipping_address&&t.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[t.jsx("span",{className:"text-sm text-gray-500",children:"Shipping Address:"}),t.jsxs("p",{className:"text-sm text-gray-900 mt-1",children:[m.shipping_address.firstName," ",m.shipping_address.lastName,t.jsx("br",{}),m.shipping_address.address,t.jsx("br",{}),m.shipping_address.city,", ",m.shipping_address.state," ",m.shipping_address.zipCode]})]})]}),t.jsxs("div",{className:"flex lg:flex-col gap-2",children:[t.jsxs(S,{variant:"outline",size:"sm",children:[t.jsx(bt,{className:"h-4 w-4 mr-1"}),"View Details"]}),m.status==="pending"&&t.jsxs(S,{size:"sm",className:"bg-blue-600 hover:bg-blue-700",children:[t.jsx(X,{className:"h-4 w-4 mr-1"}),"Process"]})]})]})})},m.id)})})}),c==="emails"&&t.jsx("div",{className:"space-y-6",children:C.length===0?t.jsx(T,{className:"text-center py-12",children:t.jsx(E,{children:t.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[t.jsx("div",{className:"p-4 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-full",children:t.jsx(Ce,{className:"h-12 w-12 text-white"})}),t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"No Email Logs Found"}),t.jsx("p",{className:"text-gray-600 max-w-md",children:f?"No email logs match your search criteria.":"Email logs will appear here as automated emails are sent to customers."}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[t.jsxs("div",{className:"flex items-center gap-2 text-green-600 bg-green-50 px-3 py-2 rounded-lg",children:[t.jsx(Ue,{className:"h-4 w-4"}),t.jsx("span",{children:"Order Confirmations"})]}),t.jsxs("div",{className:"flex items-center gap-2 text-orange-600 bg-orange-50 px-3 py-2 rounded-lg",children:[t.jsx(Wt,{className:"h-4 w-4"}),t.jsx("span",{children:"Abandoned Cart Recovery"})]}),t.jsxs("div",{className:"flex items-center gap-2 text-purple-600 bg-purple-50 px-3 py-2 rounded-lg",children:[t.jsx(it,{className:"h-4 w-4"}),t.jsx("span",{children:"14-Day Re-order Reminders"})]})]})]})})}):t.jsx("div",{className:"space-y-3",children:C.map(m=>t.jsx(T,{className:"hover:shadow-sm transition-shadow",children:t.jsx(E,{className:"p-4",children:t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{className:"flex-1 space-y-2",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[b(m.email_type),t.jsx(D,{className:`${m.opened_at?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"} border-0`,children:m.opened_at?"Opened":"Sent"})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-500",children:"Recipient:"}),t.jsx("p",{className:"font-medium text-gray-900",children:m.recipient_email})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-500",children:"Subject:"}),t.jsx("p",{className:"font-medium text-gray-900 truncate",children:m.subject})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-500",children:"Sent:"}),t.jsx("p",{className:"font-medium text-gray-900",children:new Date(m.sent_at).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})}),m.opened_at&&t.jsxs("p",{className:"text-green-600 text-xs",children:["Opened ",new Date(m.opened_at).toLocaleDateString()]})]})]})]})})})},m.id))})})]})}function Ri(){return t.jsxs("div",{className:"space-y-8",children:[t.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-semibold text-gray-900",children:"Certificates of Analysis (COAs)"}),t.jsx("p",{className:"text-gray-600 mt-1",children:"Manage lab testing certificates for your hemp products"})]})}),t.jsx(T,{className:"text-center py-12",children:t.jsx(E,{children:t.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[t.jsx("div",{className:"p-4 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-full",children:t.jsx(Cs,{className:"h-12 w-12 text-white"})}),t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"COA Management"}),t.jsx("p",{className:"text-gray-600 max-w-md",children:"Lab certificate management features are being enhanced. Upload and manage COAs for your hemp products to maintain compliance and build customer trust."}),t.jsxs("div",{className:"flex items-center gap-2 text-sm text-purple-600 bg-purple-50 px-4 py-2 rounded-lg",children:[t.jsx(ee,{className:"h-4 w-4"}),t.jsx("span",{children:"COA system ready for lab certificate uploads"})]})]})})}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[t.jsxs(T,{children:[t.jsxs(L,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(U,{className:"text-sm font-medium text-gray-600",children:"Total COAs"}),t.jsx(Lr,{className:"h-4 w-4 text-purple-600"})]}),t.jsxs(E,{children:[t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:"0"}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Ready to upload certificates"})]})]}),t.jsxs(T,{children:[t.jsxs(L,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(U,{className:"text-sm font-medium text-gray-600",children:"Approved"}),t.jsx("div",{className:"h-4 w-4 bg-green-600 rounded-full"})]}),t.jsxs(E,{children:[t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:"0"}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Approved for public display"})]})]}),t.jsxs(T,{children:[t.jsxs(L,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(U,{className:"text-sm font-medium text-gray-600",children:"Pending Review"}),t.jsx("div",{className:"h-4 w-4 bg-yellow-600 rounded-full"})]}),t.jsxs(E,{children:[t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:"0"}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Awaiting verification"})]})]})]})]})}function Ii(){const[n,e]=j.useState([]),[s,r]=j.useState(!0),[a,i]=j.useState(!1),[o,l]=j.useState(""),[c,d]=j.useState(null),[h,u]=j.useState(""),[f,g]=j.useState([]);j.useEffect(()=>{x()},[]);const x=async()=>{try{r(!0);const{data:b,error:y}=await V.from("customers").select("*").order("created_at",{ascending:!1});if(y)throw y;e(b||[])}catch(b){console.error("Failed to load customers:",b),l(b.message)}finally{r(!1)}},w=b=>{const y=b.trim().split(`
`);if(y.length<2)throw new Error("CSV must have at least a header row and one data row");const C=y[0].split(",").map(k=>k.trim().toLowerCase().replace(/["']/g,"")),m=[],_={email:["email","email_address","e-mail"],first_name:["first_name","firstname","fname","first"],last_name:["last_name","lastname","lname","last"],phone:["phone","phone_number","mobile","tel"],address:["address","street","address1"],city:["city"],state:["state","region","province"],zip_code:["zip","zip_code","zipcode","postal_code"],date_of_birth:["date_of_birth","dob","birthdate","birth_date"]},p={};for(const[k,$]of Object.entries(_)){const R=C.findIndex(B=>$.includes(B));R!==-1&&(p[k]=R)}if(!p.email||!p.first_name||!p.last_name)throw new Error("CSV must contain email, first_name, and last_name columns");for(let k=1;k<y.length;k++){const $=y[k].split(",").map(z=>z.trim().replace(/["']/g,""));if($.length<C.length)continue;const R={email:$[p.email]||"",first_name:$[p.first_name]||"",last_name:$[p.last_name]||""};p.phone&&(R.phone=$[p.phone]),p.address&&(R.address=$[p.address]),p.city&&(R.city=$[p.city]),p.state&&(R.state=$[p.state]),p.zip_code&&(R.zip_code=$[p.zip_code]),p.date_of_birth&&(R.date_of_birth=$[p.date_of_birth]),/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(R.email)&&R.first_name&&R.last_name&&m.push(R)}return m},v=async b=>{var C;const y=(C=b.target.files)==null?void 0:C[0];if(y)try{i(!0),l(""),d(null);const m=await y.text(),_=w(m);if(_.length===0)throw new Error("No valid customer data found in file");const p=[];let k=0;for(const $ of _)try{const{error:R}=await V.from("customers").upsert({...$,source:"csv_import",total_orders:0,total_spent:0},{onConflict:"email",ignoreDuplicates:!1});R?p.push(`Error importing ${$.email}: ${R.message}`):k++}catch(R){p.push(`Error importing ${$.email}: ${R.message}`)}d({success:k,errors:p}),await x()}catch(m){l(m.message||"Failed to process file")}finally{i(!1),b.target&&(b.target.value="")}},N=()=>{const C=`email,first_name,last_name,phone,address,city,state,zip_code,date_of_birth
`+`john@example.com,John,Doe,555-123-4567,123 Main St,Anytown,CA,12345,1990-01-01
`,m=new Blob([C],{type:"text/csv"}),_=window.URL.createObjectURL(m),p=document.createElement("a");p.href=_,p.download="customer_import_template.csv",p.click(),window.URL.revokeObjectURL(_)},O=n.filter(b=>h===""||b.email.toLowerCase().includes(h.toLowerCase())||`${b.first_name} ${b.last_name}`.toLowerCase().includes(h.toLowerCase()));return t.jsxs("div",{className:"space-y-8",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-semibold text-gray-900",children:"Customer Management"}),t.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your customer relationships and import leads"})]}),t.jsxs(T,{children:[t.jsx(L,{children:t.jsxs(U,{className:"flex items-center gap-2",children:[t.jsx(Ht,{className:"h-5 w-5"}),"Import Customer Data"]})}),t.jsxs(E,{children:[t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx(S,{onClick:()=>{var b;return(b=document.getElementById("csv-upload"))==null?void 0:b.click()},disabled:a,className:"bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700",children:a?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Uploading..."]}):t.jsxs(t.Fragment,{children:[t.jsx(Ht,{className:"h-4 w-4 mr-2"}),"Upload CSV/Excel"]})}),t.jsxs(S,{variant:"outline",onClick:N,children:[t.jsx(Dr,{className:"h-4 w-4 mr-2"}),"Download Template"]})]}),t.jsx("input",{id:"csv-upload",type:"file",accept:".csv,.xlsx,.xls",onChange:v,className:"hidden"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Upload a CSV or Excel file with customer data. Required columns: email, first_name, last_name. Optional: phone, address, city, state, zip_code, date_of_birth."})]}),c&&t.jsxs("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsxs(D,{variant:"secondary",className:"bg-green-100 text-green-800",children:[c.success," imported successfully"]}),c.errors.length>0&&t.jsxs(D,{variant:"destructive",children:[c.errors.length," errors"]})]}),c.errors.length>0&&t.jsxs("details",{className:"text-sm",children:[t.jsxs("summary",{className:"cursor-pointer text-red-600 font-medium",children:["View errors (",c.errors.length,")"]}),t.jsxs("div",{className:"mt-2 space-y-1",children:[c.errors.slice(0,5).map((b,y)=>t.jsx("div",{className:"text-red-600",children:b},y)),c.errors.length>5&&t.jsxs("div",{className:"text-gray-500",children:["...and ",c.errors.length-5," more"]})]})]})]})]})]}),t.jsxs(T,{children:[t.jsx(L,{children:t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs(U,{className:"flex items-center gap-2",children:[t.jsx(Pe,{className:"h-5 w-5"}),"Customers (",n.length,")"]}),t.jsx("div",{className:"flex items-center gap-2",children:t.jsx("input",{type:"text",placeholder:"Search customers...",value:h,onChange:b=>u(b.target.value),className:"px-3 py-1 border rounded-md text-sm w-64"})})]})}),t.jsx(E,{children:s?t.jsxs("div",{className:"text-center py-8",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),t.jsx("p",{className:"text-gray-600",children:"Loading customers..."})]}):o?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(ee,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),t.jsx("p",{className:"text-red-600",children:o})]}):O.length===0?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(Pe,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600",children:h?"No customers match your search":"No customers found. Import some customer data to get started."})]}):t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"border-b bg-gray-50",children:[t.jsx("th",{className:"text-left p-3 font-medium",children:"Customer"}),t.jsx("th",{className:"text-left p-3 font-medium",children:"Contact"}),t.jsx("th",{className:"text-left p-3 font-medium",children:"Location"}),t.jsx("th",{className:"text-left p-3 font-medium",children:"Orders"}),t.jsx("th",{className:"text-left p-3 font-medium",children:"Total Spent"}),t.jsx("th",{className:"text-left p-3 font-medium",children:"Source"}),t.jsx("th",{className:"text-left p-3 font-medium",children:"Joined"})]})}),t.jsx("tbody",{children:O.map(b=>t.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[t.jsx("td",{className:"p-3",children:t.jsxs("div",{children:[t.jsxs("div",{className:"font-medium",children:[b.first_name," ",b.last_name]}),t.jsx("div",{className:"text-sm text-gray-600",children:b.email})]})}),t.jsx("td",{className:"p-3",children:b.phone&&t.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[t.jsx(ks,{className:"h-4 w-4 text-gray-400"}),b.phone]})}),t.jsx("td",{className:"p-3",children:b.city&&b.state&&t.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[t.jsx($t,{className:"h-4 w-4 text-gray-400"}),b.city,", ",b.state]})}),t.jsx("td",{className:"p-3",children:t.jsx(D,{variant:"secondary",children:b.total_orders||0})}),t.jsx("td",{className:"p-3",children:t.jsx("span",{className:"font-medium text-green-600",children:M(b.total_spent||0)})}),t.jsx("td",{className:"p-3",children:t.jsx(D,{variant:b.source==="csv_import"?"outline":"secondary",className:b.source==="csv_import"?"border-blue-200 text-blue-700 bg-blue-50":"",children:b.source||"direct"})}),t.jsx("td",{className:"p-3 text-sm text-gray-600",children:new Date(b.created_at).toLocaleDateString()})]},b.id))})]})})})]}),o&&t.jsx(T,{className:"border-red-200 bg-red-50",children:t.jsx(E,{className:"pt-6",children:t.jsxs("div",{className:"flex items-center gap-2 text-red-600",children:[t.jsx(ee,{className:"h-4 w-4"}),t.jsx("span",{children:o})]})})})]})}function Li(){return t.jsxs("div",{className:"space-y-8",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-semibold text-gray-900",children:"Settings"}),t.jsx("p",{className:"text-gray-600 mt-1",children:"Configure your application settings"})]}),t.jsx(T,{className:"text-center py-12",children:t.jsx(E,{children:t.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[t.jsx("div",{className:"p-4 bg-gradient-to-br from-gray-500 to-slate-600 rounded-full",children:t.jsx($s,{className:"h-12 w-12 text-white"})}),t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Application Settings"}),t.jsx("p",{className:"text-gray-600 max-w-md",children:"Settings management is being redesigned for the new e-commerce platform with enhanced configuration options."}),t.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 bg-gray-50 px-4 py-2 rounded-lg",children:[t.jsx(ee,{className:"h-4 w-4"}),t.jsx("span",{children:"E-commerce configuration settings coming soon"})]})]})})})]})}function Di(){return t.jsxs("div",{className:"space-y-8",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-semibold text-gray-900",children:"Content Management"}),t.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your blog posts and content"})]}),t.jsx(T,{className:"text-center py-12",children:t.jsx(E,{children:t.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[t.jsx("div",{className:"p-4 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-full",children:t.jsx(Es,{className:"h-12 w-12 text-white"})}),t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Content Management"}),t.jsx("p",{className:"text-gray-600 max-w-md",children:"Content management features are being enhanced for the new e-commerce platform."}),t.jsxs("div",{className:"flex items-center gap-2 text-sm text-indigo-600 bg-indigo-50 px-4 py-2 rounded-lg",children:[t.jsx(ee,{className:"h-4 w-4"}),t.jsx("span",{children:"Focus on e-commerce functionality - content features coming soon"})]})]})})})]})}function Ui(){return t.jsxs("div",{className:"space-y-8",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-semibold text-gray-900",children:"Media Library"}),t.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your images and media files"})]}),t.jsx(T,{className:"text-center py-12",children:t.jsx(E,{children:t.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[t.jsx("div",{className:"p-4 bg-gradient-to-br from-teal-500 to-cyan-600 rounded-full",children:t.jsx(Ts,{className:"h-12 w-12 text-white"})}),t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Media Library"}),t.jsx("p",{className:"text-gray-600 max-w-md",children:"Media management features are being optimized for the e-commerce platform."}),t.jsxs("div",{className:"flex items-center gap-2 text-sm text-teal-600 bg-teal-50 px-4 py-2 rounded-lg",children:[t.jsx(ee,{className:"h-4 w-4"}),t.jsx("span",{children:"Media features being integrated with product management"})]})]})})})]})}function Bi(){return t.jsxs("div",{className:"space-y-8",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-semibold text-gray-900",children:"Marketing Hub"}),t.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your marketing campaigns"})]}),t.jsx(T,{className:"text-center py-12",children:t.jsx(E,{children:t.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[t.jsx("div",{className:"p-4 bg-gradient-to-br from-amber-500 to-orange-600 rounded-full",children:t.jsx(As,{className:"h-12 w-12 text-white"})}),t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Marketing Hub"}),t.jsx("p",{className:"text-gray-600 max-w-md",children:"Marketing automation features are being integrated with the new e-commerce system."}),t.jsxs("div",{className:"flex items-center gap-2 text-sm text-amber-600 bg-amber-50 px-4 py-2 rounded-lg",children:[t.jsx(ee,{className:"h-4 w-4"}),t.jsx("span",{children:"E-commerce priority - marketing tools coming soon"})]})]})})})]})}function Mi(){return t.jsxs("div",{className:"space-y-8",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-semibold text-gray-900",children:"Social Hub"}),t.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your social media presence"})]}),t.jsx(T,{className:"text-center py-12",children:t.jsx(E,{children:t.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[t.jsx("div",{className:"p-4 bg-gradient-to-br from-violet-500 to-purple-600 rounded-full",children:t.jsx(Ps,{className:"h-12 w-12 text-white"})}),t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Social Hub"}),t.jsx("p",{className:"text-gray-600 max-w-md",children:"Social media management features are being redesigned for better e-commerce integration."}),t.jsxs("div",{className:"flex items-center gap-2 text-sm text-violet-600 bg-violet-50 px-4 py-2 rounded-lg",children:[t.jsx(ee,{className:"h-4 w-4"}),t.jsx("span",{children:"Social features being enhanced for product promotion"})]})]})})})]})}function qi(){return t.jsxs("div",{className:"space-y-8",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-semibold text-gray-900",children:"Analytics Dashboard"}),t.jsx("p",{className:"text-gray-600 mt-1",children:"Track your business performance"})]}),t.jsx(T,{className:"text-center py-12",children:t.jsx(E,{children:t.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[t.jsx("div",{className:"p-4 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full",children:t.jsx(Os,{className:"h-12 w-12 text-white"})}),t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Analytics Dashboard"}),t.jsx("p",{className:"text-gray-600 max-w-md",children:"Advanced analytics features are being developed to track e-commerce performance."}),t.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600 bg-green-50 px-4 py-2 rounded-lg",children:[t.jsx(ee,{className:"h-4 w-4"}),t.jsx("span",{children:"E-commerce analytics being integrated"})]})]})})})]})}function Fi(){const[n,e]=j.useState([]),[s,r]=j.useState(!0),[a,i]=j.useState(""),[o,l]=j.useState("all"),[c,d]=j.useState(""),[h,u]=j.useState("featured"),[f,g]=j.useState(null),{addToCart:x,totalItems:w}=Le(),v=[{value:"all",label:"All Products",icon:X},{value:"flower",label:"THCA Flower",icon:Be},{value:"edibles",label:"Edibles",icon:Ke},{value:"concentrates",label:"Concentrates",icon:Us},{value:"topicals",label:"Topicals",icon:ot}];j.useEffect(()=>{N()},[]);const N=async()=>{try{r(!0),i("");const{data:y,error:C}=await V.from("products").select(`
          *,
          product_variants(*)
        `).eq("publish_status","published").eq("visibility_status","visible").eq("archived",!1).order("is_featured",{ascending:!1}).order("name");if(C)throw C;const m=(y||[]).map(_=>({..._,variants:_.product_variants||[]}));e(m)}catch(y){console.error("Failed to load products:",y),i(y.message||"Failed to load products")}finally{r(!1)}},O=async(y,C)=>{const m=C?`${y}-${C}`:y;try{g(m),await x(y,C,1)}catch(_){console.error("Failed to add to cart:",_)}finally{g(null)}},b=n.filter(y=>{const C=o==="all"||y.category.toLowerCase().includes(o),m=c===""||y.name.toLowerCase().includes(c.toLowerCase())||y.description.toLowerCase().includes(c.toLowerCase());return C&&m}).sort((y,C)=>{switch(h){case"price-low":return y.price-C.price;case"price-high":return C.price-y.price;case"name":return y.name.localeCompare(C.name);case"featured":default:return(C.is_featured?1:0)-(y.is_featured?1:0)}});return s?t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-blue-50 p-8",children:t.jsx("div",{className:"max-w-7xl mx-auto",children:t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600",children:"Loading premium hemp products..."})]})})})}):a?t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-blue-50 p-8",children:t.jsx("div",{className:"max-w-7xl mx-auto",children:t.jsx("div",{className:"text-center py-12",children:t.jsxs("div",{className:"p-8 bg-red-50 rounded-xl border border-red-200 inline-block",children:[t.jsx(X,{className:"h-12 w-12 text-red-600 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-semibold text-red-900 mb-2",children:"Error Loading Products"}),t.jsx("p",{className:"text-red-700 mb-4",children:a}),t.jsx(S,{onClick:N,variant:"destructive",children:"Try Again"})]})})})}):t.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-blue-50",children:[t.jsx("div",{className:"bg-gradient-to-r from-green-600 via-emerald-600 to-blue-600 text-white py-16",children:t.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center",children:[t.jsx("h1",{className:"text-4xl md:text-6xl font-bold mb-4",children:"Premium Hemp Products"}),t.jsx("p",{className:"text-xl md:text-2xl text-green-100 mb-8",children:"Lab-tested THCA flower & hemp derivatives from North Carolina"}),t.jsxs("div",{className:"flex flex-wrap justify-center gap-4 text-sm",children:[t.jsxs(D,{variant:"secondary",className:"bg-white/20 text-white border-white/30 px-4 py-2",children:[t.jsx(ot,{className:"h-4 w-4 mr-1"}),"Lab Tested"]}),t.jsxs(D,{variant:"secondary",className:"bg-white/20 text-white border-white/30 px-4 py-2",children:[t.jsx(Be,{className:"h-4 w-4 mr-1"}),"Premium Quality"]}),t.jsxs(D,{variant:"secondary",className:"bg-white/20 text-white border-white/30 px-4 py-2",children:[t.jsx(Ke,{className:"h-4 w-4 mr-1"}),"21+ Only"]})]})]})}),t.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[t.jsxs("div",{className:"bg-white rounded-xl shadow-sm border p-6 mb-8",children:[t.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[t.jsx("div",{className:"flex-1",children:t.jsxs("div",{className:"relative",children:[t.jsx(Qe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search products...",value:c,onChange:y=>d(y.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),t.jsx("div",{className:"lg:w-64",children:t.jsx("select",{value:o,onChange:y=>l(y.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:v.map(y=>t.jsx("option",{value:y.value,children:y.label},y.value))})}),t.jsx("div",{className:"lg:w-48",children:t.jsxs("select",{value:h,onChange:y=>u(y.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[t.jsx("option",{value:"featured",children:"Featured"}),t.jsx("option",{value:"name",children:"Name A-Z"}),t.jsx("option",{value:"price-low",children:"Price: Low to High"}),t.jsx("option",{value:"price-high",children:"Price: High to Low"})]})})]}),t.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t",children:[t.jsxs("p",{className:"text-sm text-gray-600",children:["Showing ",b.length," of ",n.length," products"]}),w>0&&t.jsxs(D,{variant:"default",className:"bg-blue-600",children:[t.jsx(ae,{className:"h-4 w-4 mr-1"}),w," in cart"]})]})]}),b.length===0?t.jsxs("div",{className:"text-center py-12",children:[t.jsx(X,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No products found"}),t.jsx("p",{className:"text-gray-600",children:"Try adjusting your search or filter criteria"})]}):t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:b.map(y=>t.jsxs(T,{className:"group hover:shadow-xl transition-all duration-300 border-0 shadow-md",children:[t.jsx(L,{className:"p-0",children:t.jsxs("div",{className:"relative overflow-hidden rounded-t-lg",children:[y.image_url?t.jsx("img",{src:y.image_url,alt:y.name,className:"w-full h-48 object-cover group-hover:scale-105 transition-transform duration-300"}):t.jsx("div",{className:"w-full h-48 bg-gradient-to-br from-green-100 to-emerald-200 flex items-center justify-center",children:t.jsx(Be,{className:"h-16 w-16 text-green-600"})}),t.jsxs("div",{className:"absolute top-3 left-3 flex flex-col gap-1",children:[y.is_featured&&t.jsxs(D,{className:"bg-amber-500 text-white border-0",children:[t.jsx(Ke,{className:"h-3 w-3 mr-1"}),"Featured"]}),y.lab_tested&&t.jsxs(D,{variant:"secondary",className:"bg-blue-500 text-white border-0",children:[t.jsx(ot,{className:"h-3 w-3 mr-1"}),"Lab Tested"]}),y.organic&&t.jsxs(D,{variant:"secondary",className:"bg-green-500 text-white border-0",children:[t.jsx(Be,{className:"h-3 w-3 mr-1"}),"Organic"]})]})]})}),t.jsx(E,{className:"p-4",children:t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold text-gray-900 group-hover:text-blue-600 transition-colors line-clamp-2",children:y.name}),t.jsx("p",{className:"text-sm text-gray-600 line-clamp-2 mt-1",children:y.description})]}),(y.thc_content&&y.thc_content>0||y.cbd_content&&y.cbd_content>0)&&t.jsxs("div",{className:"flex gap-2",children:[y.thc_content&&y.thc_content>0&&t.jsxs(D,{variant:"outline",className:"text-xs",children:["THC: ",y.thc_content,"%"]}),y.cbd_content&&y.cbd_content>0&&t.jsxs(D,{variant:"outline",className:"text-xs",children:["CBD: ",y.cbd_content,"%"]})]}),y.variants&&y.variants.length>0?t.jsxs("div",{className:"space-y-2",children:[t.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Available sizes:"}),t.jsx("div",{className:"grid grid-cols-2 gap-1",children:y.variants.slice(0,4).map(C=>{const m=`${y.id}-${C.id}`,_=f===m;return t.jsx(S,{variant:"outline",size:"sm",className:"h-auto p-2 text-xs flex flex-col items-center",onClick:()=>O(y.id,C.id),disabled:_||C.inventory<=0,children:_?t.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b border-current"}):t.jsxs(t.Fragment,{children:[t.jsxs("span",{className:"font-medium",children:[C.weight,C.weight_unit]}),t.jsx("span",{className:"text-blue-600 font-semibold",children:M(C.price)})]})},C.id)})})]}):t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-2xl font-bold text-blue-600",children:M(y.price)}),t.jsx(S,{onClick:()=>O(y.id),disabled:f===y.id,className:"bg-gradient-to-r from-emerald-600 to-green-700 hover:from-emerald-700 hover:to-green-800",children:f===y.id?t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):t.jsxs(t.Fragment,{children:[t.jsx(Je,{className:"h-4 w-4 mr-1"}),"Add to Cart"]})})]})]})})]},y.id))})]})]})}const zi=[{code:"NC",name:"North Carolina"},{code:"SC",name:"South Carolina"},{code:"VA",name:"Virginia"},{code:"TN",name:"Tennessee"},{code:"GA",name:"Georgia"}];function Vi(){const n=js(),{items:e,totalAmount:s,clearCart:r}=Le(),[a,i]=j.useState(!1),[o,l]=j.useState(!1),[c,d]=j.useState(""),[h,u]=j.useState("shipping"),[f,g]=j.useState(!1),[x,w]=j.useState(null),[v,N]=j.useState({firstName:"",lastName:"",email:"",phone:"",address:"",city:"",state:"NC",zipCode:"",birthDate:""}),O=9.99,b=s*.0875,y=s+O+b;j.useEffect(()=>{const p=document.createElement("script");return p.src="https://web.squarecdn.com/v1/square.js",p.onload=()=>{window.Square&&g(!0)},document.head.appendChild(p),()=>{document.head.removeChild(p)}},[]),j.useEffect(()=>{f&&h==="payment"&&!x&&C()},[f,h]);const C=async()=>{try{const k=await window.Square.payments("sq0idp-n-Bn5n-cjEgFEIMZLWml9g","C3DR5GQSB6ON5").card();await k.attach("#card-container"),w(k)}catch(p){console.error("Square payment initialization error:",p),d("Payment system initialization failed")}},m=p=>{p.preventDefault(),u("payment")},_=async p=>{var k,$,R;if(p.preventDefault(),!(!x||e.length===0)){i(!0),d("");try{const B=await x.tokenize();if(B.status!=="OK")throw new Error((($=(k=B.errors)==null?void 0:k[0])==null?void 0:$.message)||"Payment tokenization failed");const{data:z,error:De}=await V.functions.invoke("square-payment",{body:{amount:y,cartItems:e.map(fe=>({product_id:fe.product_id,variant_id:fe.variant_id,product_name:fe.product_name,price:fe.price,quantity:fe.quantity,product_image_url:fe.product_image_url})),customerEmail:v.email,shippingAddress:v,billingAddress:v,paymentToken:B.token}});if(De)throw De;if(((R=z==null?void 0:z.data)==null?void 0:R.status)==="completed")l(!0),u("confirmation"),await r();else throw new Error("Payment was not completed successfully")}catch(B){console.error("Payment error:",B),d(B.message||"Payment failed. Please try again.")}finally{i(!1)}}};return e.length===0&&!o?t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-blue-50 p-8",children:t.jsx("div",{className:"max-w-2xl mx-auto text-center py-16",children:t.jsx(T,{className:"p-8",children:t.jsxs(E,{className:"text-center",children:[t.jsx(He,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),t.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-2",children:"Your cart is empty"}),t.jsx("p",{className:"text-gray-600 mb-6",children:"Add some products before checkout"}),t.jsxs(S,{onClick:()=>n("/store"),className:"bg-gradient-to-r from-blue-600 to-indigo-700",children:[t.jsx(Kt,{className:"h-4 w-4 mr-2"}),"Continue Shopping"]})]})})})}):t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-blue-50 p-8",children:t.jsxs("div",{className:"max-w-6xl mx-auto",children:[t.jsxs("div",{className:"mb-8",children:[t.jsxs(S,{variant:"ghost",onClick:()=>h==="payment"?u("shipping"):n("/store"),className:"mb-4",children:[t.jsx(Kt,{className:"h-4 w-4 mr-2"}),h==="payment"?"Back to Shipping":"Back to Store"]}),t.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Secure Checkout"}),t.jsx("div",{className:"flex items-center mt-6 space-x-4",children:[{key:"shipping",label:"Shipping",icon:Jt},{key:"payment",label:"Payment",icon:He},{key:"confirmation",label:"Confirmation",icon:yt}].map((p,k)=>{const $=p.icon,R=h===p.key,B=p.key==="shipping"&&["payment","confirmation"].includes(h)||p.key==="payment"&&h==="confirmation";return t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:`flex items-center justify-center w-10 h-10 rounded-full border-2 ${B?"bg-green-600 border-green-600 text-white":R?"bg-blue-600 border-blue-600 text-white":"border-gray-300 text-gray-400"}`,children:t.jsx($,{className:"h-5 w-5"})}),t.jsx("span",{className:`ml-2 text-sm font-medium ${R?"text-blue-600":B?"text-green-600":"text-gray-500"}`,children:p.label}),k<2&&t.jsx("div",{className:`ml-4 w-16 h-0.5 ${B?"bg-green-600":"bg-gray-300"}`})]},p.key)})})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[t.jsxs("div",{className:"lg:col-span-2",children:[h==="shipping"&&t.jsxs(T,{children:[t.jsx(L,{children:t.jsxs(U,{className:"flex items-center gap-2",children:[t.jsx(Jt,{className:"h-5 w-5"}),"Shipping Information"]})}),t.jsx(E,{children:t.jsxs("form",{onSubmit:m,className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"First Name *"}),t.jsx("input",{type:"text",required:!0,value:v.firstName,onChange:p=>N(k=>({...k,firstName:p.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Last Name *"}),t.jsx("input",{type:"text",required:!0,value:v.lastName,onChange:p=>N(k=>({...k,lastName:p.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address *"}),t.jsx("input",{type:"email",required:!0,value:v.email,onChange:p=>N(k=>({...k,email:p.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number *"}),t.jsx("input",{type:"tel",required:!0,value:v.phone,onChange:p=>N(k=>({...k,phone:p.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date of Birth *"}),t.jsx("input",{type:"date",required:!0,value:v.birthDate||"",onChange:p=>N(k=>({...k,birthDate:p.target.value})),max:new Date().toISOString().split("T")[0],className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Address *"}),t.jsx("input",{type:"text",required:!0,value:v.address,onChange:p=>N(k=>({...k,address:p.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"City *"}),t.jsx("input",{type:"text",required:!0,value:v.city,onChange:p=>N(k=>({...k,city:p.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"State *"}),t.jsx("select",{required:!0,value:v.state,onChange:p=>N(k=>({...k,state:p.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:zi.map(p=>t.jsx("option",{value:p.code,children:p.name},p.code))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ZIP Code *"}),t.jsx("input",{type:"text",required:!0,value:v.zipCode,onChange:p=>N(k=>({...k,zipCode:p.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),t.jsx(S,{type:"submit",className:"w-full mt-6 bg-gradient-to-r from-blue-600 to-indigo-700",children:"Continue to Payment"})]})})]}),h==="payment"&&t.jsxs(T,{children:[t.jsx(L,{children:t.jsxs(U,{className:"flex items-center gap-2",children:[t.jsx(He,{className:"h-5 w-5"}),"Payment Information"]})}),t.jsx(E,{children:t.jsxs("form",{onSubmit:_,className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Card Information"}),t.jsx("div",{id:"card-container",className:"p-4 border border-gray-300 rounded-lg bg-white min-h-[60px] flex items-center justify-center",children:!f&&t.jsx("div",{className:"text-gray-500",children:"Loading secure payment form..."})})]}),t.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[t.jsx(vt,{className:"h-4 w-4"}),t.jsx("span",{children:"Your payment information is secure and encrypted with Square"})]}),c&&t.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:t.jsx("p",{className:"text-sm text-red-800",children:c})}),t.jsx(S,{type:"submit",disabled:!f||!x||a,className:"w-full bg-gradient-to-r from-emerald-600 to-green-700 hover:from-emerald-700 hover:to-green-800",children:a?"Processing Payment...":`Pay ${M(y)}`})]})})]}),h==="confirmation"&&o&&t.jsx(T,{children:t.jsxs(E,{className:"text-center py-12",children:[t.jsx(yt,{className:"h-16 w-16 text-green-600 mx-auto mb-4"}),t.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-2",children:"Payment Successful!"}),t.jsx("p",{className:"text-gray-600 mb-6",children:"Thank you for your purchase. You will receive a confirmation email shortly."}),t.jsx("div",{className:"space-y-2",children:t.jsx(S,{onClick:()=>n("/store"),className:"bg-gradient-to-r from-blue-600 to-indigo-700",children:"Continue Shopping"})})]})})]}),t.jsx("div",{className:"lg:col-span-1",children:t.jsxs(T,{className:"sticky top-8",children:[t.jsx(L,{children:t.jsx(U,{children:"Order Summary"})}),t.jsxs(E,{className:"space-y-4",children:[e.map(p=>t.jsxs("div",{className:"flex justify-between items-start",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"font-medium text-sm",children:p.product_name}),p.variant_name&&t.jsx("p",{className:"text-xs text-gray-600",children:p.variant_name}),t.jsxs("p",{className:"text-xs text-gray-600",children:["Qty: ",p.quantity]})]}),t.jsx("span",{className:"font-medium",children:M(p.price*p.quantity)})]},`${p.product_id}-${p.variant_id||"default"}`)),t.jsxs("div",{className:"border-t pt-4 space-y-2",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Subtotal:"}),t.jsx("span",{children:M(s)})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Shipping:"}),t.jsx("span",{children:M(O)})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Tax:"}),t.jsx("span",{children:M(b)})]}),t.jsxs("div",{className:"flex justify-between font-semibold text-lg border-t pt-2",children:[t.jsx("span",{children:"Total:"}),t.jsx("span",{children:M(y)})]})]})]})]})})]})]})})}function Wi(){return t.jsx(Vi,{})}const Hi=[{code:"AL",name:"Alabama"},{code:"AK",name:"Alaska"},{code:"AZ",name:"Arizona"},{code:"AR",name:"Arkansas"},{code:"CA",name:"California"},{code:"CO",name:"Colorado"},{code:"CT",name:"Connecticut"},{code:"DE",name:"Delaware"},{code:"FL",name:"Florida"},{code:"GA",name:"Georgia"},{code:"HI",name:"Hawaii"},{code:"ID",name:"Idaho"},{code:"IL",name:"Illinois"},{code:"IN",name:"Indiana"},{code:"IA",name:"Iowa"},{code:"KS",name:"Kansas"},{code:"KY",name:"Kentucky"},{code:"LA",name:"Louisiana"},{code:"ME",name:"Maine"},{code:"MD",name:"Maryland"},{code:"MA",name:"Massachusetts"},{code:"MI",name:"Michigan"},{code:"MN",name:"Minnesota"},{code:"MS",name:"Mississippi"},{code:"MO",name:"Missouri"},{code:"MT",name:"Montana"},{code:"NE",name:"Nebraska"},{code:"NV",name:"Nevada"},{code:"NH",name:"New Hampshire"},{code:"NJ",name:"New Jersey"},{code:"NM",name:"New Mexico"},{code:"NY",name:"New York"},{code:"NC",name:"North Carolina"},{code:"ND",name:"North Dakota"},{code:"OH",name:"Ohio"},{code:"OK",name:"Oklahoma"},{code:"OR",name:"Oregon"},{code:"PA",name:"Pennsylvania"},{code:"RI",name:"Rhode Island"},{code:"SC",name:"South Carolina"},{code:"SD",name:"South Dakota"},{code:"TN",name:"Tennessee"},{code:"TX",name:"Texas"},{code:"UT",name:"Utah"},{code:"VT",name:"Vermont"},{code:"VA",name:"Virginia"},{code:"WA",name:"Washington"},{code:"WV",name:"West Virginia"},{code:"WI",name:"Wisconsin"},{code:"WY",name:"Wyoming"},{code:"DC",name:"District of Columbia"}];function Ki({isOpen:n,onClose:e,onVerified:s}){const[r,a]=j.useState(""),[i,o]=j.useState(""),[l,c]=j.useState(!1),[d,h]=j.useState(""),[u,f]=j.useState("welcome");if(!n)return null;const g=async()=>{var w,v;if(!r||!i){h("Please fill in all fields");return}try{c(!0),h("");const{data:N,error:O}=await V.functions.invoke("age-verification",{body:{birthDate:r,stateCode:i,sessionId:crypto.randomUUID()}});if(O)throw O;(w=N==null?void 0:N.data)!=null&&w.verified?(sessionStorage.setItem("ageVerified","true"),sessionStorage.setItem("ageVerificationSession",N.data.sessionId),s(N.data.sessionId),e()):(f("error"),h(((v=N==null?void 0:N.data)==null?void 0:v.message)||"Age verification failed"))}catch(N){console.error("Age verification error:",N),h(N.message||"Verification failed. Please try again.")}finally{c(!1)}},x=()=>{u==="error"?window.location.href="https://www.google.com":e()};return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm",children:t.jsxs(T,{className:"w-full max-w-md mx-4 shadow-2xl border-0",children:[t.jsxs(L,{className:"text-center bg-gradient-to-r from-blue-600 to-indigo-700 text-white rounded-t-lg",children:[u!=="error"&&t.jsx(S,{variant:"ghost",size:"icon",className:"absolute right-2 top-2 text-white hover:bg-white/20",onClick:x,children:t.jsx(Ot,{className:"h-5 w-5"})}),t.jsx("div",{className:"flex justify-center mb-4",children:u==="error"?t.jsx(Rs,{className:"h-12 w-12 text-orange-300"}):t.jsx(vt,{className:"h-12 w-12 text-blue-200"})}),t.jsx(U,{className:"text-xl font-bold",children:u==="welcome"?"Age Verification Required":u==="verification"?"Verify Your Age":"Access Restricted"}),t.jsx("p",{className:"text-blue-100 text-sm mt-2",children:u==="welcome"?"You must be 21 or older to access this site":u==="verification"?"Please provide your information":"You must be 21+ to access this content"})]}),t.jsxs(E,{className:"p-6",children:[u==="welcome"&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Legal Requirements"}),t.jsx("p",{className:"text-sm text-gray-600 leading-relaxed",children:"This website contains information about hemp and THCA products. By federal and state law, you must be at least 21 years old to view this content."})]}),t.jsxs("div",{className:"flex items-center gap-3 p-4 bg-blue-50 rounded-lg border border-blue-200",children:[t.jsx(vt,{className:"h-5 w-5 text-blue-600 flex-shrink-0"}),t.jsxs("div",{className:"text-sm text-blue-800",children:[t.jsx("strong",{children:"Your Privacy:"})," We use this information only for age verification and do not store personal details."]})]}),t.jsx(S,{onClick:()=>f("verification"),className:"w-full bg-gradient-to-r from-blue-600 to-indigo-700 hover:from-blue-700 hover:to-indigo-800",children:"Continue to Verification"})]}),u==="verification"&&t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t.jsx(Is,{className:"h-4 w-4 inline mr-1"}),"Date of Birth"]}),t.jsx("input",{type:"date",value:r,onChange:w=>a(w.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",max:new Date().toISOString().split("T")[0],required:!0})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t.jsx($t,{className:"h-4 w-4 inline mr-1"}),"State/Territory"]}),t.jsxs("select",{value:i,onChange:w=>o(w.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0,children:[t.jsx("option",{value:"",children:"Select your state"}),Hi.map(w=>t.jsx("option",{value:w.code,children:w.name},w.code))]})]}),d&&t.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:t.jsx("p",{className:"text-sm text-red-800",children:d})}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx(S,{variant:"outline",onClick:()=>f("welcome"),className:"flex-1",disabled:l,children:"Back"}),t.jsx(S,{onClick:g,disabled:l||!r||!i,className:"flex-1 bg-gradient-to-r from-emerald-600 to-green-700 hover:from-emerald-700 hover:to-green-800",children:l?"Verifying...":"Verify Age"})]})]}),u==="error"&&t.jsxs("div",{className:"space-y-4 text-center",children:[t.jsxs("div",{className:"p-4 bg-orange-50 border border-orange-200 rounded-lg",children:[t.jsx("p",{className:"text-sm text-orange-800 mb-2",children:t.jsx("strong",{children:"Access Denied:"})}),t.jsx("p",{className:"text-sm text-orange-700",children:d})]}),t.jsx("p",{className:"text-sm text-gray-600",children:"You must be 21 years or older to access this website."}),t.jsx(S,{onClick:x,className:"w-full bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800",children:"Leave Site"})]})]})]})})}function Ji(){const[n,e]=We.useState(!1),[s,r]=We.useState(!1),[a,i]=We.useState(null);j.useEffect(()=>{const c=sessionStorage.getItem("ageVerified")==="true",d=sessionStorage.getItem("ageVerificationSession");c&&d?(e(!0),i(d),r(!1)):(r(!0),e(!1))},[]);const o=c=>{e(!0),i(c),r(!1),sessionStorage.setItem("ageVerified","true"),sessionStorage.setItem("ageVerificationSession",c)},l=()=>{n?r(!1):window.location.href="https://google.com"};return t.jsx(vi,{children:t.jsxs(xr,{children:[t.jsxs(Mt,{children:[t.jsx(W,{path:"/store",element:t.jsx(Fi,{})}),t.jsx(W,{path:"/checkout",element:t.jsx(Wi,{})}),t.jsx(W,{path:"/*",element:t.jsx(Si,{children:t.jsxs(Mt,{children:[t.jsx(W,{path:"/",element:t.jsx(qt,{to:"/dashboard",replace:!0})}),t.jsx(W,{path:"/dashboard",element:t.jsx(Pi,{})}),t.jsx(W,{path:"/products",element:t.jsx(Oi,{})}),t.jsx(W,{path:"/coas",element:t.jsx(Ri,{})}),t.jsx(W,{path:"/orders",element:t.jsx($i,{})}),t.jsx(W,{path:"/customers",element:t.jsx(Ii,{})}),t.jsx(W,{path:"/settings",element:t.jsx(Li,{})}),t.jsx(W,{path:"/content",element:t.jsx(Di,{})}),t.jsx(W,{path:"/media",element:t.jsx(Ui,{})}),t.jsx(W,{path:"/marketing",element:t.jsx(Bi,{})}),t.jsx(W,{path:"/social",element:t.jsx(Mi,{})}),t.jsx(W,{path:"/analytics",element:t.jsx(qi,{})}),t.jsx(W,{path:"*",element:t.jsx(qt,{to:"/dashboard",replace:!0})})]})})})]}),s&&!n&&t.jsx(Ki,{isOpen:s,onClose:l,onVerified:o})]})})}qs(document.getElementById("root")).render(t.jsx(j.StrictMode,{children:t.jsx(Yr,{children:t.jsx(Ji,{})})}));
